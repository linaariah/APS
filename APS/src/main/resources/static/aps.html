<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="UTF-8">
    <title>制造执行系统</title>
    <script src="js/jquery.js"></script>
    <script src="js/vue.js"></script>
    <script src="js/echarts.js"></script>
    <script src="element-ui/lib/index.js"></script>
    <link rel="stylesheet" href="element-ui/lib/theme-chalk/index.css">
    <script src="js/axios-0.18.0.js"></script>
</head>
<style>
    body {
        background-image: url("./img/BP3.png");
        opacity: 0.9;
        margin: 0;
    }

    /*.roll-dialog .el-dialog__body {*/
    /*    padding: 3px 30px;*/
    /*    overflow-y: auto;*/
    /*    height: calc(90vh - 130px);*/
    /*}*/
    /*center class="roll-dialog"*/

    .customWidth1 {
        width: 1100px;
    }
    .customWidth2 {
        width: 800px;
    }
    .customWidth3 {
        width: 1100px;
    }

    .header {
        background-color: #0e539a;
        padding: 10px 10px 10px 50px;
        color: white;
        font-size: 18px;
        margin: 10px;
        box-shadow: 0px 4px 4px rgb(0 0 0 / 12%), 0px 1px 2px rgb(0 0 0 / 24%);
    }

    .el-main {
        background: #f6f6f6;
        border: 2px;
        margin: 10px;
        box-shadow: 0px 4px 4px rgb(0 0 0 / 12%), 0px 1px 2px rgb(0 0 0 / 24%);
    }

    .el-row {
        margin-bottom: 20px;

    }

    .el-col {
        border-radius: 4px;
    }

    .bg-purple-dark {
        background: #99a9bf;
    }

    .bg-purple {
        background: #f6f6f6;
    }

    .bg-purple-light {
        background: #f6f6f6;
    }

    .grid-content {
        border-radius: 4px;
        min-height: 36px;
        padding: 10px 10px 10px 10px;
    }

    .row-bg {
        padding: 10px 0;
        background-color: #f9fafc;
    }

    .el-table--striped .el-table__body tr.el-table__row--striped.current-row td,
    .el-table__body tr.current-row>td {
        color: #fff;
        background-color: #a2a4a7 !important;
    }
</style>


<body>
    <div id="app">
<!-- -----------------------------------------------------------------------------------------------页面head -->
        <div class="header">
            <h1 style='margin: 20px 0px 0px 0px;'>制造执行系统</h1>
            <div style='color:#ffffff;text-align: right;'>
                你好<br>
                <span>系统管理员</span>
            </div>
        </div>
        <el-container>
            <div style='margin: 0px 0px 0px 10px;'>
                <el-button style='background-color:#0e539a;border-color:#0e539a;' type="primary" icon="el-icon-arrow-left"
                    @click="myReturn">返回主菜单
                </el-button>
            </div>
        </el-container>
<!-- -----------------------------------------------------------------------------------------------页面head END -->
        
<!-- 内容表单+ 生产排程表 + 甘特图-------------------------------------------------------------------------------- -->
        <el-container>
            <el-main>
                <!-- 大标题 -->
                <el-row style='margin-bottom: 0px;'>
                    <el-col :span="6">
                        <div class="grid-content bg-purple"></div>
                    </el-col>
                    <el-col :span="12">
                        <div style='text-align: center;color: #bd2d30;font-size: 30px;'>生产排程系统</div>
                    </el-col>
                    <el-col :span="6">
                        <div class="grid-content bg-purple"></div>
                    </el-col>
                </el-row>

                <!--功能栏------------------------------------------------------------------------------------------>
                <el-row>
                    <el-col :span="24">
                        <div class="grid-content bg-purple" style="box-shadow: 4px 0 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
                						  background-color: #ffffff;">
                            <div style='padding:10px'>
                                <div style='padding:10px 10px 10px 10px'>
        
                                    <!--生产任务单号-->
                                    <span style='color: #909399;font-weight:bolder;'>生产任务单号：</span>
                                    <el-input placeholder="请输入内容" style='width:220px;margin:0px 10px 10px 0px;'
                                        v-model.trim="newScheduleRecord.productionNumber">
                                    <!--排程记录按钮-->
                                    <el-button slot="append" icon="el-icon-search" @click="openRecordList">排程记录</el-button>
                                    </el-input>
        
                                    <!--订单编号-->
                                    <span style='color: #909399;font-weight:bolder;'>订单编号：</span>
                                    <el-input placeholder="可以为空" style='width:90px;margin:0px 10px 10px 0px;'
                                        v-model.trim="newScheduleRecord.orderNumber"></el-input>
        
                                    <!--客户名称-->
                                    <span style='color: #909399;font-weight:bolder;'>客户名称：</span>
                                    <el-input placeholder="可以为空" style='width:90px;margin:0px 10px 10px 0px;'
                                        v-model.trim="newScheduleRecord.customerName"></el-input>
        
                                    <!--物料编号-->
                                    <span style='color: #909399;font-weight:bolder;'>物料编号：</span>
                                    <el-input :disabled="true" placeholder="需生产排程的物料"
                                        style='width:266px;margin:0px 10px 10px 0px;' v-bind:value="newScheduleRecord.partNo">
                                    <el-button slot="append" icon="el-icon-search" @click="openPartList">选择物料</el-button>
                                    </el-input>
        
                                    <!--物料名称-->
                                    <span style='color: #909399;font-weight:bolder;'>物料名称：</span>
                                    <el-input :disabled="true" style='width:190px;margin:0px 10px 10px 0px;'
                                        v-bind:value="newScheduleRecord.partName"></el-input>
                                    </br>
        
                                    <!--需求数量 div控制间隔------------->
                                    <div style="margin-top: 25px;">
                                    <span style='color: #909399;font-weight:bolder;'>需求数量：</span>
                                    <el-input-number :min="1" :max="1000" v-model="newScheduleRecord.number" :step="100">
                                    </el-input-number>
        
        
                                    <span style='color: #909399;font-weight:bolder;margin-left: 10px'>排产日期：</span>
                                    <el-date-picker v-model="newScheduleRecord.date" type="date" placeholder="选择日期"
                                        format="yyyy 年 MM 月 dd 日" value-format="yyyy-MM-dd"></el-date-picker>
        
                                    <el-button @click="resetInput" style="margin-left: 37px">重置输入框</el-button>
        
                                    <el-button type="info" plain @click="dialogEquipmentVisible = true">设备信息查询
                                    </el-button>
        
                                    <el-button type="primary" @click="schedule">生产排程计算</el-button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </el-col>
                </el-row>

 <!-- 第一块内容表单END---------------------------------------------------------------------------------------------- -->
        
<!--生产排程表---------------------------------------------------------------------------------------------------------->
                <el-row>
                    <el-col :span="24">
                        <div class="grid-content bg-purple" style="box-shadow: 4px 0 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
                                  background-color: #ffffff;">
                            <div style='padding:10px'>
                                <div style='padding:10px 10px 10px 10px'>
                                    <div style="margin-bottom: 20px;">
                                        <span style='color: #909399;font-weight:bolder'>生产排程表：</span>
                                    </div>
                               
                                    <el-table :data="recordDetailDataList" border style="width: 100%;" height="550"
                                        v-loading="loading" :fit="true">
                                        <el-table-column label="序号" width="150" type="index" :index="indexAdd">
                                        </el-table-column>
                                        <el-table-column prop="productionNumber" label="生产任务单号"></el-table-column>
                                        <el-table-column prop="equipid" label="设备编号"></el-table-column>
                                        <el-table-column prop="equipname" label="设备名称"></el-table-column>
                                        <el-table-column prop="starttime" label="开始加工时间"></el-table-column>
                                        <el-table-column prop="endtime" label="结束加工时间"></el-table-column>
                                        <!-- <el-table-column prop="production_number" label="排产日期" width="150"></el-table-column> -->
                                        <el-table-column prop="number" label="需求数量"></el-table-column>
                                        <el-table-column prop="model" label="加工型号"></el-table-column>
        
                                    </el-table>
                                
                                <div style="margin: auto;">
                                    <el-pagination @current-change="handleCurrentPageChange" :page-size="10"
                                        layout="total, prev, pager, next" :total="pageTotal" :current-page="currentPage"  align="center" >
                                    </el-pagination>
                                </div>
        
        
                                </div>
                            </div>
                        </div>
                    </el-col>
                </el-row>
        
<!--生产排程表END---------------------------------------------------------------------------------------------------------->        
        
<!--生产排程甘特图--------------------------------------------------------------------------------------------------------->
                <el-row>
                    <el-col :span="24">
                        <div class="grid-content bg-purple" style="box-shadow: 4px 0 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
                						  background-color: #ffffff;">
                            <div style='padding:10px'>
                                <div style='padding:10px 10px 10px 10px'>
                                    <span style='color: #909399;font-weight:bolder;'>生产排程甘特图：</span>
                                    <div id="main" style="width: 1100px;height:400px;">
        
        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </el-col>
                </el-row>
        
<!--生产排程甘特图 END--------------------------------------------------------------------------------------------------------->       
                     
            </el-main>
        </el-container>

<!-- 页面元素END------------------------------------------------------------------------------------------------------- -->
<!-- 页面元素END------------------------------------------------------------------------------------------------------- -->
<!-- 内容表单+ 生产排程表 + 甘特图--------------------------------------------------------------------------------------- -->

  <!--Record排程记录弹出框-------------------------------------------->
  <el-dialog title="排程记录" :visible.sync="dialogRecordVisible" custom-class="customWidth1" :show-close="false">
                                          
    <!-- 添加一个搜索框模糊搜索待开发 -->

    <el-table :data="recordDataList" highlight-current-row @current-change="handleCurrentChangeRecord" height="450" v-loading="loading" ref="singleTable">
        <el-table-column prop="productionNumber" label="生产任务单号" width="120"></el-table-column>
        <el-table-column prop="orderNumber" label="订单编号" width="100"></el-table-column>
        <el-table-column prop="customerName" label="客户名称"></el-table-column>
        <el-table-column prop="partNo" label=" 物料编号" width="150"></el-table-column>
        <el-table-column prop="partName" label="物料名称" width="160"></el-table-column>
        <el-table-column prop="number" label="需求数量" width="100"></el-table-column>
        <el-table-column prop="date" label="排产日期" width="100"></el-table-column>
        <el-table-column prop="createTime" label="创建时间" width="200"></el-table-column>
    </el-table>
    <span slot="footer" class="dialog-footer">
        <el-button type="danger" plain @click="deleteRecord">删除</el-button>
        <el-button @click="recordCancel">取 消</el-button>
        <el-button type="primary" @click="recordConfirm">查 询</el-button>
    </span>
</el-dialog>    


<!--Part选择物料弹出框----------------------------------------------------------->
        <el-dialog title="生产排程物料选择" :visible.sync="dialogPartVisible" :show-close="false" :fit="true" custom-class="customWidth2">
            <!--下拉菜单-->
            <span style='color: #909399;font-weight:bolder;'>查询所属零件名称：</span>
            <el-select v-model="modelname" placeholder="请选择" clearable @change="searchModelName">
                <el-option v-for="item in modelNameList" :key="item.model" :label="item.model" :value="item.model">
                </el-option>
            </el-select>
            <el-table :data="partDataList" highlight-current-row @current-change="handleCurrentChangePart" height="210" ref="singleTable2">

                <el-table-column prop="partS" label="物料编号"></el-table-column>
                <el-table-column prop="partSName" label="物料名称"></el-table-column>
                <el-table-column prop="model" label="所属规格型号"></el-table-column>
            </el-table>
            <span slot="footer" class="dialog-footer">
                <el-button @click="partCancel">取 消</el-button>
                <el-button type="primary" @click="partConfirm">确 定</el-button>
            </span>
        </el-dialog>


<!--Equipment设备信息查询弹出框-------------------------------------------------->
        <el-dialog title="设备信息查询" :visible.sync="dialogEquipmentVisible" custom-class="customWidth3" :show-close="false">
            <!--下拉菜单-->
            <span style='color: #909399;font-weight:bolder;'>查询所属零件名称：</span>
            <el-select v-model="partname" placeholder="请选择" clearable @change="searchPartName">
                <el-option v-for="item in partNameList" :key="item.partname" :label="item.partname"
                    :value="item.partname">
                </el-option>
            </el-select>

            <el-table :data="equipmentDataList" height="450">
                <el-table-column prop="equipid" label="设备编号" width="100"></el-table-column>
                <el-table-column prop="equipname" label="设备名称" width="180"></el-table-column>
                <el-table-column prop="stationid" label="工位" width="140"></el-table-column>
                <el-table-column prop="processname" label="工序" width="140"></el-table-column>
                <el-table-column prop="ct" label="节拍/s"></el-table-column>
                <el-table-column prop="level" label="加工等级"></el-table-column>
                <el-table-column prop="processorder" label="加工次序"></el-table-column>
                <el-table-column prop="partname" label="所属零件名称" width="150"></el-table-column>
            </el-table>
            <span slot="footer" class="dialog-footer">
                <el-button type="info" @click="eHide">隐 藏</el-button>
            </span>
        </el-dialog>




        

    </div>

</body>


<script>
    var app = new Vue({
        el: '#app',
        data: {
            dialogRecordVisible: false,//生产排程记录
            dialogPartVisible: false,//物料选择
            dialogEquipmentVisible: false,//设备信息查询
            loading: true,      //加载框

            recordDataList: [],//排程记录
            recordDetailDataList: [],//生产排程对应详细表格

            partDataList: [],//选择物料
            modelNameList: [],//所属产品型号
            modelname: '',//选择器显示


            equipmentDataList: [],//设备信息查询
            partNameList: [],//所属零件名称表
            partname: '',//选择器显示

            newScheduleRecord: {
                productionNumber: '',//生产任务单号
                orderNumber: '',//订单编号
                customerName: '',//客户名称
                partNo: '',//物料编号
                partName: '',//物料名称
                number: 100, //需求数量
                date:'',//排产日期
                createTime: '',//创建时间
            },

            pageTotal:1,//fenye
            currentPage:1,

        },


        //钩子函数，VUE对象初始化完成后自动执行
        created() {
            this.dateFormat();
            this.getRecordAll();
            this.getEquipmentAll();
            this.getPartAll();
            this.getRecordDetailAll();
        setTimeout(() => {this.loading=false}, 1500);

        },
        // mounted() {
        //     var myCharts = echarts.init(document.getElementById('main'));
        //     var option = {

        //         legend: {
        //             y: 'bottom',
        //             data: ['计划时间', '实际时间']  //修改的地方1

        //         },
        //         grid: {
        //             containLabel: true,
        //             left: 20
        //         },
        //         xAxis: {
        //             type: 'time'
        //         },

        //         yAxis: {

        //             data: ['M1', 'M2', 'M3', 'M4', 'M5', 'M6', 'M7']

        //         },
        //         tooltip: {
        //             trigger: 'axis',
        //             formatter: function (params) {
        //                 var res = params[0].name + "</br>"
        //                 var date0 = params[0].data;
        //                 var date1 = params[1].data;
        //                 var date2 = params[2].data;
        //                 var date3 = params[3].data;
        //                 date0 = date0.getFullYear() + "-" + (date0.getMonth() + 1) + "-" + date0.getDate();
        //                 date1 = date1.getFullYear() + "-" + (date1.getMonth() + 1) + "-" + date1.getDate();
        //                 date2 = date2.getFullYear() + "-" + (date2.getMonth() + 1) + "-" + date2.getDate();
        //                 date3 = date3.getFullYear() + "-" + (date3.getMonth() + 1) + "-" + date3.getDate();
        //                 res += params[0].seriesName + "~" + params[1].seriesName + ":</br>" + date0 + "~" + date1 + "</br>"
        //                 res += params[2].seriesName + "~" + params[3].seriesName + ":</br>" + date2 + "~" + date3 + "</br>"
        //                 console.log(params[0]);
        //                 return res;
        //             }
        //         },
        //         series: [

        //             {
        //                 name: '计划开始时间',
        //                 type: 'bar',
        //                 stack: 'test1',
        //                 itemStyle: {
        //                     normal: {
        //                         color: 'rgba(0,0,0,0)'
        //                     }
        //                 },
        //                 data: [
        //                     new Date("2022/09/2"),
        //                     new Date("2022/09/15"),
        //                     new Date("2022/09/15"),
        //                     new Date("2022/10/03"),
        //                     new Date("2022/10/04"),
        //                     new Date("2022/10/05"),
        //                     new Date("2022/10/06")
        //                 ]
        //             },
        //             {
        //                 name: '计划时间',
        //                 type: 'bar',
        //                 stack: 'test1',
        //                 //修改地方2
        //                 itemStyle: {
        //                     normal: {
        //                         color: '#F98563'
        //                     }
        //                 },
        //                 data: [
        //                     new Date("2022/09/12"),
        //                     new Date("2022/09/20"),
        //                     new Date("2022/09/25"),
        //                     new Date("2022/10/05"),
        //                     new Date("2022/10/07"),
        //                     new Date("2022/10/09"),
        //                     new Date("2022/10/12")
        //                 ]
        //             },
        //             {
        //                 name: '实际开始时间',
        //                 type: 'bar',
        //                 stack: 'test2',
        //                 itemStyle: {
        //                     normal: {
        //                         color: 'rgba(0,0,0,0)'
        //                     }
        //                 },
        //                 data: [
        //                     new Date("2022/09/2"),
        //                     new Date("2022/09/15"),
        //                     new Date("2022/09/15"),
        //                     new Date("2022/10/03"),
        //                     new Date("2022/10/04"),
        //                     new Date("2022/10/05"),
        //                     new Date("2022/10/06")
        //                 ]
        //             },
        //             {
        //                 name: '实际时间',
        //                 type: 'bar',
        //                 stack: 'test2',
        //                 //修改地方3
        //                 itemStyle: {
        //                     normal: {
        //                         color: '#A2E068'
        //                     }
        //                 },
        //                 data: [
        //                     new Date("2022/09/6"),
        //                     new Date("2022/09/20"),
        //                     new Date("2022/09/27"),
        //                     new Date("2022/10/11"),
        //                     new Date("2022/10/16"),
        //                     new Date("2022/10/18"),
        //                     new Date("2022/10/17")
        //                 ]
        //             }
        //         ]
        //     };
        //     myCharts.setOption(option);

        // },

        methods: { 

            //返回功能
            myReturn() {
                location.href = 'main.html';
            },
       
            //获取当前时间
            dateFormat() {
                // 为小于10的数字补零
                let date = new Date();
                let year = date.getFullYear();
                let month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
                let day = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
                let hours = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
                let minutes = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                let seconds = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();
                var createTime = year + "-" + month + "-" + day + " " + hours + ":" + minutes + ":" + seconds;
                var today = year + "-" + month + "-" + day
                this.newScheduleRecord.createTime = createTime;
                this.newScheduleRecord.date=today;
                window.today=today;
            },

            //时间戳改字符串函数
            timeCalculate(time){
                let timeTemp = new Date(time)             
                            let year = timeTemp.getFullYear();
                            let month = timeTemp.getMonth() + 1 < 10 ? "0" + (timeTemp.getMonth() + 1) : timeTemp.getMonth() + 1;
                            let day = timeTemp.getDate() < 10 ? "0" + timeTemp.getDate() : timeTemp.getDate();
                            let hours = timeTemp.getHours() < 10 ? "0" + timeTemp.getHours() : timeTemp.getHours();
                            let minutes = timeTemp.getMinutes() < 10 ? "0" + timeTemp.getMinutes() : timeTemp.getMinutes();
                            let seconds = timeTemp.getSeconds() < 10 ? "0" + timeTemp.getSeconds() : timeTemp.getSeconds();
                            return year + "-" + month + "-" + day + " " + hours + ":" + minutes + ":" + seconds;
            },
             
            //删除数组重复元素
             repeat(arr) {

                for (var i = 0; i < arr.length; i++) {
                    for (var j = i + 1; j < arr.length; j++) {//第一次是拿第一个数据和剩余的n-1个数据判断是否相等、第二次是拿第二个数据和剩余的n-1个数据相比
                        if (arr[i] == arr[j]) {

                            var del = j;

                            arr.splice(del, 1);//找到了该数据的下标就删除了
                        }
                    }
                }
                return arr;
            },

            //表格选中行
            handleCurrentChangeRecord(val) {
                this.currentRow = val;
                if(this.currentRow===null){
                    return
                }
                else{
                    this.newScheduleRecord.productionNumber=this.currentRow.productionNumber
                }
            },
            handleCurrentChangePart(val) {
                this.currentRow = val;
            },

            //重置输入框
            resetInput() {
                this.newScheduleRecord.productionNumber = '';
                this.newScheduleRecord.orderNumber = '';
                this.newScheduleRecord.customerName = '';
                this.newScheduleRecord.partNo = '';
                this.newScheduleRecord.partName = '';
                this.newScheduleRecord.number = 100;
                this.newScheduleRecord.date = today;
            },
    
            //打开生产排程记录
            openRecordList(row) {
                this.dialogRecordVisible = true
                this.$nextTick(() => {
                this.$refs.singleTable.setCurrentRow(row);
                this.newScheduleRecord.productionNumber = ''
            })
                

            },

            //  获取生产排程记录
            getRecordAll() {
                axios({
                    url: "http://localhost:8080/recordList",
                    method: 'GET'
                }).then(res => {
                    this.recordDataList = res.data.data;
                })

            },

            // 获取生产排程详细记录
            getRecordDetailAll(){
                axios({
                    url: "http://localhost:8080//recordDetailList",
                    method: 'GET',
                    params:{
                        current:1,
                        productionNumber:''
                    }
                }).then(res => {
                    this.recordDetailDataList = res.data.data;
                    this.pageTotal=res.data.total
                })
                

            },

            //分页选择器
            handleCurrentPageChange(val){
                this.currentPage=val
                // console.log("选中了第几页",val)
                axios({
                    url: "http://localhost:8080//recordDetailList",
                    method: 'GET',
                    params:{
                        current: this.currentPage,
                        productionNumber: this.newScheduleRecord.productionNumber
                    }
                }).then(res => {
                    this.recordDetailDataList = res.data.data;
                    this.pageTotal=res.data.total
                })
            },

            //表格索引连续
            indexAdd(index) {
                // console.log(index)
                const page = this.currentPage // 当前页码
                const pagesize = 10 // 每页条数
                return index + 1 + (page - 1) * pagesize
            },
    
            //  生产排程记录弹窗查询与取消
            openPartList(row){
                this.dialogPartVisible = true;
                this.$nextTick(() => {
                this.$refs.singleTable2.setCurrentRow(row)
            })
            },
            recordConfirm() {
                this.dialogRecordVisible = false;
                this.newScheduleRecord.productionNumber=this.currentRow.productionNumber
                this.newScheduleRecord.orderNumber=this.currentRow.orderNumber
                this.newScheduleRecord.customerName=this.currentRow.customerName
                this.newScheduleRecord.partNo=this.currentRow.partNo
                this.newScheduleRecord.partName=this.currentRow.partName
                this.newScheduleRecord.number=this.currentRow.number
                this.newScheduleRecord.date=this.currentRow.date
              

                axios({
                    url: "http://localhost:8080//recordDetailList",
                    method: 'GET',
                    params:{
                        current:1,
                        productionNumber:this.newScheduleRecord.productionNumber

                    }
                }).then(res => {
                    this.recordDetailDataList = res.data.data;
                    this.pageTotal=res.data.total
                    this.loading=true
                    setTimeout(() => {this.loading=false}, 800);
                })
               

            },
            recordCancel() {
                this.resetInput();
                this.loading=true
                    setTimeout(() => {this.loading=false}, 800);
                this.dialogRecordVisible = false;
                this.newScheduleRecord.productionNumber =''
                this.getRecordDetailAll();

            },
            //  生产排程记录弹窗查询与取消--------------------------------------------------END

            //删除生产排程记录
            deleteRecord() {
                // console.log("delete按钮按下了",this.newScheduleRecord.productionNumber)
                if(this.newScheduleRecord.productionNumber ===''){
                    this.$message({
                            message: '请选择要删除的数据',
                            type: 'error'
                        })
                }
                else 
                {     
                axios({
                    url: 'http://localhost:8080/deleteRecord',
                    method: 'POST',
                    data: this.newScheduleRecord,
                }).then(res => {
                    if (res.data.code = 20021) 
                    {
                        this.loading=true
                        setTimeout(() => {this.loading=false}, 800)
                        setTimeout(() => { this.$message({
                            message: '删除成功',
                            type: 'success'
                        })}, 1200)
                        //删除成功标语
                       
                    }

                }).finally(() => {
                    this.getRecordAll();
                    
                })

                axios({
                            url: 'http://localhost:8080/deleteRecordDetail',
                            method: 'POST',
                            data: this.newScheduleRecord,
                        }).then(res => {
                        }).finally(()=>{
                            this.getRecordDetailAll();
                        })
               
                    }
            },
            //删除生产排程记录-------------------------------------------------------------END


            //生产物料选择查询------------------------
            getPartAll() {
                //发送ajax请求
                axios({
                    url: "http://localhost:8080/partList",
                    method: 'GET'
                }).then(res => {
                    this.partDataList = res.data.data;
                }),
                    axios({
                        url: "http://localhost:8080/modelNameList",
                        method: 'GET'
                    }).then(res => {
                        this.modelNameList = res.data.data;
                    })
            },
            //搜索物料功能---------------------------
            searchModelName()
             {
                param = "?modelname=" + this.modelname;
                if (this.modelname != '') {   
                    axios.get('http://localhost:8080/searchModelNameList/' + param).then(res => {
                        this.partDataList = res.data
                    })
                }
                else { this.getPartAll() }
            },
           // 物料选择弹框确认与关闭
            partCancel() {
                this.dialogPartVisible = false;
                this.newScheduleRecord.partNo = '';
                this.newScheduleRecord.partName = '';
                

            },
            partConfirm() {
                this.dialogPartVisible = false;
                this.newScheduleRecord.partNo = this.currentRow.partS;
                this.newScheduleRecord.partName = this.currentRow.partSName;

            },



            //设备信息查询----------------------------------------------------------------
            getEquipmentAll() {
                axios({
                    url: "http://localhost:8080/equipmentList",
                    method: 'GET'
                }).then(res => {
                    this.equipmentDataList = res.data.data;
                    var Equip = res.data.data;
                        window.Equip = Equip;
                }),
                    axios({
                        url: "http://localhost:8080/partNameList",
                        method: 'GET'
                    }).then(res => {
                        this.partNameList = res.data.data;
                    })

                    //计算排程用
                    //生产排程计算
                    //A：转子轴+转子+转子轴承组件 、B：前端盖、C：后端盖、 D：机座、E：定子、F：机座定子、G：三相异步电机
                
            },
            //设备信息根据物料搜索功能
            searchPartName() {
                param = "?partname=" + this.partname;
                if (this.partname != '') {
                    axios.get('http://localhost:8080/searchPartNameList/' + param).then(res => {
                        this.equipmentDataList = res.data
                    })
                }
                else { this.getEquipmentAll() }
            },

            //设备信息隐藏
            eHide() {
                this.dialogEquipmentVisible = false;
            },

//-------------------------------------------------------------------------------------
            //排程计算
            schedule() {
                // return new Promise((resolve,reject) =>{
                    

                if (this.newScheduleRecord.productionNumber == '') {
                    this.$message.error('请输入生产任务单号');
                }
                else if (this.newScheduleRecord.partNo == '') {
                    this.$message.error('请选择物料');
                }
                else if (this.newScheduleRecord.date == '') {
                    this.$message.error('请选择排产日期');
                }
                else {
                    
                    console.log('生产任务单号:', this.newScheduleRecord.productionNumber);
                    console.log('订单编号:', this.newScheduleRecord.orderNumber);
                    console.log('客户名称:', this.newScheduleRecord.customerName);
                    console.log('物料编号:', this.newScheduleRecord.partNo);
                    console.log('物料名称:', this.newScheduleRecord.partName);
                    console.log('需求数量:', this.newScheduleRecord.number);
                    console.log('排产日期:', this.newScheduleRecord.date);
                    console.log('创建时间:', this.newScheduleRecord.createTime);

                    //提交表单
                    axios({
                        url: 'http://localhost:8080/addRecord',
                        method: 'POST',
                        data: this.newScheduleRecord,
                    }).then(res => {

                        if (res.data.code == 20011) {
                            this.$message('计算中，请稍后……');

                    //当日首计划逻辑-------------------------------------------------------------------------------------------------------------

                    var timeEndList1 = [] //3.5级
                    var timeEndList2 = [] //3.4级
                    var timeEndList3 = [] //3.3级
                    var timeEndList4 = [] //3.2级
                    var timeEndList5 = [] //3.1级
                    var timeEndList6 = [] //2.1级
                    var timeEndList7 = [] //1.1级

                    for (var i = 0; i < Equip.length; i++) {

                        if (Equip[i].level === 3.5)//3.5级设备加工时间计算
                        {
                            if (Equip[i].processorder === 1) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeDate + ' ' + '08:30:00' //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                  //设备开始加工时间与结束时间
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {
                                    
                                })
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层


                            else if (Equip[i].processorder === 2) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList1[0] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/2                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                            else if (Equip[i].processorder === 3) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList1[1] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/3                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                            else if (Equip[i].processorder === 4) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList1[2] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/3                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层
                            
                            else if (Equip[i].processorder === 5) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList1[3] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/2                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                            else if (Equip[i].processorder === 6) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList1[4] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/3                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                            else if (Equip[i].processorder === 7) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList1[5] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/4                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                            else if (Equip[i].processorder === 8) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList1[6] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/4                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                            else if (Equip[i].processorder === 9) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList1[7] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/8                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                            else if (Equip[i].processorder === 10) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList1[8] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/4                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                            else if (Equip[i].processorder === 11) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList1[9] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/2                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                        }
                       
                        else if (Equip[i].level === 3.4) //3.4级设备加工时间计算
                        {

                            if (Equip[i].processorder === 1) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeDate + ' ' + '08:30:00' //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/4                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                  //设备开始加工时间与结束时间
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {
                                    
                                })
                                
                                timeEndList2.push(timeEnd3)
                                this.repeat(timeEndList2)
                                
                                
                            } //if order层


                            else if (Equip[i].processorder === 2) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList2[0] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/2                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
        
                                timeEndList2.push(timeEnd3)
                                this.repeat(timeEndList2)
                                
                            } //if order层

                        }

                        else if (Equip[i].level === 3.3) //3.3级设备加工时间计算
                        {

                            if (Equip[i].processorder === 1) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeDate + ' ' + '08:30:00' //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/2                 //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                  //设备开始加工时间与结束时间
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {
                                    
                                })
                                
                                timeEndList3.push(timeEnd3)
                                this.repeat(timeEndList3)
                                
                                
                            } //if order层


                            else if (Equip[i].processorder === 2) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList3[0] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/2                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList3.push(timeEnd3)
                                this.repeat(timeEndList3)
                                
                            } //if order层

                        }

                        else if (Equip[i].level === 3.2) //3.2级设备加工时间计算
                        {
                            if (Equip[i].processorder === 1) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeDate + ' ' + '08:30:00' //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/4                 //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                  //设备开始加工时间与结束时间
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {
                                    
                                })
                                
                                timeEndList4.push(timeEnd3)
                                this.repeat(timeEndList4)
                                
                                
                            } //if order层


                            else if (Equip[i].processorder === 2) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList4[0] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/3                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList4.push(timeEnd3)
                                this.repeat(timeEndList4)
                                
                            } //if order层
                        }

                        else if (Equip[i].level === 3.1) //3.1级设备加工时间计算
                        {

                            if (Equip[i].processorder === 1) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeDate + ' ' + '08:30:00' //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/5                 //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                  //设备开始加工时间与结束时间
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {
                                    
                                })
                                
                                timeEndList5.push(timeEnd3)
                                this.repeat(timeEndList5)
                                
                                
                            } //if order层


                            else if (Equip[i].processorder === 2) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList5[0] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/5                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList5.push(timeEnd3)
                                this.repeat(timeEndList5)
                                
                            } //if order层

                            else if (Equip[i].processorder === 3) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList5[1] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/5                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList5.push(timeEnd3)
                                this.repeat(timeEndList5)
                                
                            } //if order层
                            else if (Equip[i].processorder === 4) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList5[2] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/5                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList5.push(timeEnd3)
                                this.repeat(timeEndList5)
                                
                            } //if order层
                            else if (Equip[i].processorder === 5) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList5[3] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/5                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList5.push(timeEnd3)
                                this.repeat(timeEndList5)
                                
                            } //if order层
                            else if (Equip[i].processorder === 6) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList5[4] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/5                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList5.push(timeEnd3)
                                this.repeat(timeEndList5)
                                
                            } //if order层
                            else if (Equip[i].processorder === 7) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList5[5] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/5                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList5.push(timeEnd3)
                                this.repeat(timeEndList5)
                                
                            } //if order层
                            else if (Equip[i].processorder === 8) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList5[6] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList5.push(timeEnd3)
                                this.repeat(timeEndList5)
                                
                            } //if order层

                        }

                        else if (Equip[i].level === 2.1) //2.1级设备加工时间计算
                        {

                            if (Equip[i].processorder === 1) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期

                                //时间比较3.1、3.2
                                let compareArr=[Date.parse(new Date(timeEndList4[timeEndList4.length-1])),Date.parse(new Date(timeEndList5[timeEndList5.length-1]))]
                                
                                // console.log("时间最大值",this.timeCalculate(Math.max.apply(null,compareArr)))

                                // let compare1 = Date.parse(new Date(timeEndList4[timeEndList4.length-1]))
                                // let compare2 = Date.parse(new Date(timeEndList5[timeEndList5.length-1]))

                                let timeStart3 = this.timeCalculate(Math.max.apply(null,compareArr)) //2级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//2级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/2                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //2级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                  //设备开始加工时间与结束时间
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {
                                    
                                })
                                
                                timeEndList6.push(timeEnd3)
                                this.repeat(timeEndList6)
                                
                                
                            } //if order层

                        }

                        else if (Equip[i].level === 1.1) //1.1级设备加工时间计算
                        {

                            if (Equip[i].processorder === 1) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期

                                //时间比较3.1、3.2、3.3、2.1
                                let compareArr=[Date.parse(new Date(timeEndList1[timeEndList1.length-1])),Date.parse(new Date(timeEndList2[timeEndList2.length-1])),Date.parse(new Date(timeEndList3[timeEndList3.length-1])),Date.parse(new Date(timeEndList6[timeEndList6.length-1]))]
                                
                                // console.log("时间最大值",this.timeCalculate(Math.max.apply(null,compareArr)))

                                // let compare1 = Date.parse(new Date(timeEndList4[timeEndList4.length-1]))
                                // let compare2 = Date.parse(new Date(timeEndList5[timeEndList5.length-1]))

                                let timeStart3 = this.timeCalculate(Math.max.apply(null,compareArr)) //1级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//1级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/3                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //1级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                  //设备开始加工时间与结束时间
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {
                                    
                                })
                                
                                timeEndList7.push(timeEnd3)
                                this.repeat(timeEndList7)
                                
                                
                            } //if order层

                            else if (Equip[i].processorder === 2) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList7[0] //1级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number                   //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList7.push(timeEnd3)
                                this.repeat(timeEndList7)
                                
                            } //if order层

                            else if (Equip[i].processorder === 3) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 = timeEndList7[1] //1级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/2                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList7.push(timeEnd3)
                                this.repeat(timeEndList7)
                                
                            } //if order层

                        }

                    } //for End---------------------------------------------------------------
                    // console.log("for循环结束打印3.5：",timeEndList1)
                    // console.log("for循环结束打印3.4：",timeEndList2)
                    // console.log("for循环结束打印3.3：",timeEndList3)
                    // console.log("for循环结束打印3.2：",timeEndList4)
                    // console.log("for循环结束打印3.1：",timeEndList5)
                    // console.log("for循环结束打印2.1：",timeEndList6)
                    // console.log("for循环结束打印1.1：",timeEndList7)
                    // setTimeout( this.schedule2 ,1000 )

                    axios({
                    url: "http://localhost:8080/equipmentList",
                    method: 'GET'
                }).then(res => {
                    var Equip2 = res.data.data;
                    console.log(Equip2)

                    for (var j = 0; j < Equip.length; j++) {
                        let recordDetail = {}
                        recordDetail.productionNumber = this.newScheduleRecord.productionNumber
                        recordDetail.equipid = Equip2[j].equipid
                        recordDetail.equipname = Equip2[j].equipname
                        recordDetail.number = this.newScheduleRecord.number
                        recordDetail.starttime = Equip2[j].starttime
                        recordDetail.endtime = Equip2[j].endtime
                        recordDetail.model = this.newScheduleRecord.partName
                        axios({
                            url: 'http://localhost:8080/addRecordDetail',
                            method: 'POST',
                            data: recordDetail,
                        }).then(res => {
                        })
                    }
                }).finally(() => {
                    // this.getRecordDetailAll();
                    axios({
                    url: "http://localhost:8080//recordDetailList",
                    method: 'GET',
                    params:{
                        current:1,
                        productionNumber:this.newScheduleRecord.productionNumber
                    }
                }).then(res => {
                    this.recordDetailDataList = res.data.data;
                    this.pageTotal=res.data.total
                })
                  
                    this.loading=true,
                    setTimeout(() => {this.loading=false}, 1000);

                })//finally


                        }  //if (res.data.code == 20011) End

                        else {
                            this.$message.error('该生产任务单号已经存在！请重新输入！');
                        }
                    }).finally(() => {
                            this.getRecordAll();
                            
                        });//finally

                    
                } //else
            
            // })//promise

            // this.resetInput()
            },

        







        }
    })
</script>

</html>