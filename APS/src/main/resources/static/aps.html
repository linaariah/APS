<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="UTF-8">
    <title>制造执行系统</title>
    <script src="js/jquery.js"></script>
    <script src="js/vue.js"></script>
    <script src="js/echarts.js"></script>
    <script src="element-ui/lib/index.js"></script>
    <link rel="stylesheet" href="element-ui/lib/theme-chalk/index.css">
    <script src="js/axios-0.18.0.js"></script>
</head>
<style>
    body {
        background-image: url("./img/BP3.png");
        opacity: 0.9;
        margin: 0;
    }


    /*.roll-dialog .el-dialog__body {*/
    /*    padding: 3px 30px;*/
    /*    overflow-y: auto;*/
    /*    height: calc(90vh - 130px);*/
    /*}*/
    /*center class="roll-dialog"*/

    .dialogRecordVisible {
        width: 1000px;
    }
    .dialogModelVisible {
        width: 600px;
    }
    .dialogEquipmentVisible {
        width: 90%;
    }

    .header {
        background-color: #0e539a;
        padding: 10px 10px 10px 50px;
        color: white;
        font-size: 18px;
        margin: 10px;
        box-shadow: 0px 4px 4px rgb(0 0 0 / 12%), 0px 1px 2px rgb(0 0 0 / 24%);
    }

    .el-main {
        background: #f6f6f6;
        border: 2px;
        margin: 10px;
        box-shadow: 0px 4px 4px rgb(0 0 0 / 12%), 0px 1px 2px rgb(0 0 0 / 24%);
    }

    .el-row {
        margin-bottom: 20px;

    }

    .el-col {
        border-radius: 4px;
    }

    .bg-purple-dark {
        background: #99a9bf;
    }

    .bg-purple {
        background: #f6f6f6;
    }

    .bg-purple-light {
        background: #f6f6f6;
    }

    .grid-content {
        border-radius: 4px;
        min-height: 36px;
        padding: 10px 10px 10px 10px;
    }

    .row-bg {
        padding: 10px 0;
        background-color: #f9fafc;
    }

    .el-table--striped .el-table__body tr.el-table__row--striped.current-row td,
    .el-table__body tr.current-row>td {
        color: #fff;
        background-color: #a2a4a7 !important;
    }
</style>


<body>
    <div id="app">
<!-- -----------------------------------------------------------------------------------------------页面head -->
        <div class="header">
            <h1 style='margin: 20px 0px 0px 0px;'>制造执行系统</h1>
            <div style='color:#ffffff;text-align: right;'>
                你好<br>
                <span>系统管理员</span>
            </div>
        </div>
        <el-container>
            <div style='margin: 0px 0px 0px 10px;'>
                <el-button style='background-color:#0e539a;border-color:#0e539a;' type="primary" icon="el-icon-arrow-left"
                    @click="myReturn">返回主菜单
                </el-button>
            </div>
        </el-container>
<!-- -----------------------------------------------------------------------------------------------页面head END -->
        
<!-- 内容表单+ 生产排程表 + 甘特图-------------------------------------------------------------------------------- -->
        <el-container>
            <el-main>
                <!-- 大标题 -->
                <el-row style='margin-bottom: 0px;'>
                    <el-col :span="6">
                        <div class="grid-content bg-purple"></div>
                    </el-col>
                    <el-col :span="12">
                        <div style='text-align: center;color: #bd2d30;font-size: 30px;'>生产排程系统</div>
                    </el-col>
                    <el-col :span="6">
                        <div class="grid-content bg-purple"></div>
                    </el-col>
                </el-row>

                <!--功能栏------------------------------------------------------------------------------------------>
                <el-row>
                    <el-col :span="24">
                        <div class="grid-content bg-purple" style="box-shadow: 4px 0 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
                						  background-color: #ffffff;">
                            <div style='padding:10px'>
                                <div style='padding:10px 10px 10px 10px'>
        
                                    <!--生产任务单号-->
                                    <span style='color: #909399;font-weight:bolder;'>生产任务单号：</span>
                                    <el-input placeholder="请输入内容" style='width:220px;margin:0px 10px 10px 0px;'
                                        v-model.trim="newScheduleRecord.productionNumber">
                                    <!--排程记录按钮-->
                                    <el-button slot="append" icon="el-icon-search" @click="openRecord">排程记录</el-button>
                                    </el-input>
        
                                    <!--订单编号-->
                                    <span style='color: #909399;font-weight:bolder;'>订单编号：</span>
                                    <el-input placeholder="可以为空" style='width:90px;margin:0px 10px 10px 0px;'
                                        v-model.trim="newScheduleRecord.orderNumber"></el-input>
        
                                    <!--客户名称-->
                                    <span style='color: #909399;font-weight:bolder;'>客户名称：</span>
                                    <el-input placeholder="可以为空" style='width:90px;margin:0px 10px 10px 0px;'
                                        v-model.trim="newScheduleRecord.customerName"></el-input>
        
                                    <!--产品型号-->
                                    <span style='color: #909399;font-weight:bolder;'>产品型号：</span>
                                    <el-input :disabled="true" placeholder="需生产排程的产品"
                                        style='width:266px;margin:0px 10px 10px 0px;' v-bind:value="newScheduleRecord.model">
                                    <el-button slot="append" icon="el-icon-search" @click="openModel">选择型号</el-button>
                                    </el-input>
        
                                    <!-- 物料名称
                                    <span style='color: #909399;font-weight:bolder;'>物料名称：</span>
                                    <el-input :disabled="true" style='width:190px;margin:0px 10px 10px 0px;'
                                        v-bind:value="newScheduleRecord.partName"></el-input> -->
                                    
                                     <!--需求数量  -->
                                    <span style='color: #909399;font-weight:bolder;'>需求数量：</span>
                                    <el-input-number :min="1" :max="1000" v-model="newScheduleRecord.number" :step="100">
                                    </el-input-number>
                                </br>

                                <!--排产日期 div控制间隔------------->
                                <div style="margin-top: 25px;">
                                    <span style='color: #909399;font-weight:bolder;margin-left: 10px'>排产日期：</span>
                                    <el-date-picker v-model="newScheduleRecord.date" type="date" placeholder="选择日期"
                                        format="yyyy 年 MM 月 dd 日" value-format="yyyy-MM-dd"></el-date-picker>
        
                                        <el-button  @click="openEquipmentBom" style="margin-left: 37px">设备信息Bom表</el-button>
                                    
                                        <el-button type="success" @click="newScheduleRecordResetInput" style="margin-left: 57px">重置输入框</el-button>
        
                                    <el-button type="primary" :loading="scheduleButton" @click="calculate">生产排程计算</el-button>
                                    
                                    </div>
                                </div>
                            </div>
                        </div>
                    </el-col>
                </el-row>

 <!-- 第一块内容表单END---------------------------------------------------------------------------------------------- -->
        
<!--生产排程表---------------------------------------------------------------------------------------------------------->
                <el-row>
                    <el-col :span="24">
                        <div class="grid-content bg-purple" style="box-shadow: 4px 0 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
                                  background-color: #ffffff;">
                            <div style='padding:10px'>
                                <div style='padding:10px 10px 10px 10px'>
                                    <div style="margin-bottom: 20px;">
                                        <span style='color: #909399;font-weight:bolder'>生产排程表：</span>
                                    </div>
                                    
                                    <span style='color: #909399;font-size: small;'>生产任务单号：</span>
                                    <el-input placeholder="请输入生产任务单号" v-model.trim="searchRecordDetailList.productionNumber" prefix-icon="el-icon-search"
                                        style='width:190px;margin:0px 10px 10px 0px;'></el-input>
                                    
                                    <span style='color: #909399;font-size: small;'>加工型号：</span>
                                    <el-input placeholder="请输入加工型号" v-model.trim="searchRecordDetailList.model" style='width:200px;margin:0px 10px 10px 0px;'>
                                    </el-input>
                                    
                                    <span style='color: #909399;font-size: small;'>需求数量：</span>
                                    <el-input placeholder="请输入需求数量" v-model.trim="searchRecordDetailList.number" style='width:130px;margin:0px 10px 10px 0px;'>
                                    </el-input>
                                    
                                    <span style='color: #909399;font-size: small;'>设备编号：</span>
                                    <el-input placeholder="请输入设备编号" v-model.trim="searchRecordDetailList.equipid" style='width:140px;margin:0px 10px 10px 0px;'>
                                    </el-input>
                                    
                                    <span style='color: #909399;font-size: small;'>设备名称：</span>
                                    <el-input placeholder="请输入设备名称" v-model.trim="searchRecordDetailList.equipname"
                                        style='width:190px;margin:0px 10px 10px 0px;'></el-input>
                                    
                                    <div style="margin-top: 10px;font-size: small;">
                                        <span style='color: #909399;'>开始加工时间：</span>
                                        <el-input placeholder="yyyy-MM-dd HH:mm:ss" v-model="searchRecordDetailList.starttime"
                                            style='width:190px;margin:0px 10px 10px 0px;'></el-input>
                                    
                                        <span style='color: #909399;font-size: small;'>结束加工时间：</span>
                                        <el-input placeholder="yyyy-MM-dd HH:mm:ss" v-model="searchRecordDetailList.endtime"
                                            style='width:190px;margin:0px 10px 10px 0px;'></el-input>
                                        <el-button type="primary" plain icon="el-icon-refresh-right" style="margin-left: 30px;" @click="clearRecordDetail">重置</el-button>
                                        <el-button type="primary" plain icon="el-icon-search" @click="searchRecordDetail">搜索</el-button>
                                    </div>



                                    <el-table :data="recordDetailDataList" border style="width: 100%;" height="550"
                                        v-loading="loadingRecordDetail" :fit="true"  stripe>
                                        <el-table-column label="序号" width="150" type="index" :index="indexAdd">
                                        </el-table-column>
                                        <el-table-column prop="productionNumber" label="生产任务单号"></el-table-column>
                                        <el-table-column prop="model" label="加工型号"></el-table-column>
                                        <el-table-column prop="number" label="需求数量"></el-table-column>
                                        <el-table-column prop="equipid" label="设备编号"></el-table-column>
                                        <el-table-column prop="equipname" label="设备名称"></el-table-column>
                                        <el-table-column prop="starttime" label="开始加工时间"></el-table-column>
                                        <el-table-column prop="endtime" label="结束加工时间"></el-table-column>
                                        
                                        
        
                                    </el-table>
                                
                                <div style="margin: auto;">
                                    <el-pagination @current-change="handleCurrentPageChange" :page-size="10"
                                        layout="total, prev, pager, next" :total="pageTotal" :current-page="currentPage"  align="center" >
                                    </el-pagination>
                                </div>
        
        
                                </div>
                            </div>
                        </div>
                    </el-col>
                </el-row>
        
<!--生产排程表END---------------------------------------------------------------------------------------------------------->        
        
<!--生产排程甘特图--------------------------------------------------------------------------------------------------------->
                <el-row>
                    <el-col :span="24">
                        <div class="grid-content bg-purple" style="box-shadow: 4px 0 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
                						  background-color: #ffffff;">
                            <div style='padding:10px'>
                                <div style='padding:10px 10px 10px 10px'>
                                    <span style='color: #909399;font-weight:bolder;'>生产排程甘特图：</span>
                                    <div id="main" style="width: 1100px;height:400px;">
        
        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </el-col>
                </el-row>
        
<!--生产排程甘特图 END--------------------------------------------------------------------------------------------------------->       
                     
            </el-main>
        </el-container>
<!-- 内容表单+ 生产排程表 + 甘特图--------------------------------------------------------------------------------------- -->



  <!--Record排程记录弹出框-------------------------------------------->
  <el-dialog title="排程记录" :visible.sync="dialogRecordVisible" custom-class="dialogRecordVisible">
    <div style="margin-bottom:20px ;">
        <span style='color: #909399;font-weight:bolder;'>提示：若要重新排程进行删除操作时，请删除当天所有的排程计划，再重新排程当天计划!</span>
        <span style='color: #909399;font-weight:bolder;'></span>
      </div>                               
    <!-- 添加一个搜索框模糊搜索 -->
    <el-input placeholder="请输入生产任务单号" v-model.trim="inputRecordSearch1" clearable prefix-icon="el-icon-search" style='width:250px;margin:0px 10px 10px 0px;'></el-input>
    <el-date-picker v-model="inputRecordSearch2" type="date" placeholder="选择日期" value-format="yyyy-MM-dd"></el-date-picker>
    
    
    <el-button type="success" @click="searchRecord" style="margin-left:60px ;">搜索</el-button>
    
    <el-tooltip class="item" effect="dark" content="请点击选择要删除的记录行后再删除" placement="right">
        <el-button type="danger" @click="deleteRecord">删除</el-button>
      </el-tooltip>
     
    
    <el-table :data="recordDataList" highlight-current-row @current-change="handleCurrentChangeRecord" height="380" v-loading="loadingRecord" ref="singleTableRecord"  stripe fit>
        <el-table-column prop="productionNumber" label="生产任务单号"></el-table-column>
        <el-table-column prop="orderNumber" label="订单编号" ></el-table-column>
        <el-table-column prop="customerName" label="客户名称"></el-table-column>
        <el-table-column prop="model" label="产品型号"></el-table-column>
        <!-- <el-table-column prop="partName" label="物料名称" width="160"></el-table-column> -->
        <el-table-column prop="number" label="需求数量"></el-table-column>
        <el-table-column prop="date" label="排产日期"></el-table-column>
        <el-table-column prop="createTime" label="创建时间" width="160"></el-table-column>
    </el-table>
    <span slot="footer" class="dialog-footer">
        
        <el-button @click="closeRecord">关 闭</el-button>
        <el-button type="primary" @click="confirmRecord">查 询</el-button>
    </span>
</el-dialog>

<!-- Record 删除记录确认弹出框 -->
<el-dialog title="提示" :visible.sync="dialogRecordDeleteVisible" width="500px" :show-close="false">
    <i class="el-icon-warning"></i>
  <span>此操作将永久删除</span>
  <span style="font-weight: bold;">{{newScheduleRecord.date}}</span>
  <span>的所有排程记录, 是否继续?</span>
  
  <span slot="footer" class="dialog-footer">
    <el-button @click="recordDeleteCancel">取 消</el-button>
    <el-button type="primary" @click="recordDeleteConfirm">确 定</el-button>
  </span>
</el-dialog>



<!--Model选择弹出框----------------------------------------------------------->
        <el-dialog title="产品型号选择" :visible.sync="dialogModelVisible" :show-close="false" :fit="true" custom-class="dialogModelVisible">
            <el-table :data="modelDataList" highlight-current-row @current-change="handleCurrentChangeModel" height="210" ref="singleTableModel" :header-cell-style="{'text-align':'center'}"
            :cell-style="{'text-align':'center'}">

                <el-table-column  label="序号" type="index" width="150"></el-table-column>
                <el-table-column prop="model" label="产品型号"></el-table-column>
            </el-table>
            <span slot="footer" class="dialog-footer">
                <el-button @click="closeModel">关 闭</el-button>
                <el-button type="primary" @click="confirmModel">确 定</el-button>
            </span>
        </el-dialog>


        <!--EquipmentBom设备信息查询弹出框-------------------------------------------------->
        <el-dialog title="设备信息Bom表" :visible.sync="dialogEquipmentVisible" custom-class="dialogEquipmentVisible">
        
            <span style='color: #909399;font-weight:bolder;'>产品型号：</span>
            <el-input placeholder="请输入产品型号" style='width:150px;margin:0px 10px 10px 0px;' v-model.trim="newEquipmentBom.model">
            </el-input>
        
            <span style='color: #909399;font-weight:bolder;'>设备名称：</span>
            <el-input :disabled="true" placeholder="请选择加工的设备" style='width:270px;margin:0px 10px 10px 0px;'
                v-model="newEquipmentBom.equipname">
                <el-button slot="append" icon="el-icon-search" @click="chooseEquipment">选择设备</el-button>
            </el-input>
        
            <span style='color: #909399;font-weight:bolder;'>设备编号：</span>
            <el-input :disabled="true" placeholder="请选择加工的设备" style='width:170px;margin:0px 10px 10px 0px;' v-model="newEquipmentBom.equipid">
            </el-input>
        
            <span style='color: #909399;font-weight:bolder;'>工序名称：</span>
            <el-input style='width:150px;margin:0px 10px 10px 0px;' v-model="newEquipmentBom.processname" placeholder="请输入工序名称">
            </el-input>
        
            <span style='color: #909399;font-weight:bolder;'>节拍时间(/s)：</span>
            <el-input style='width:110px;margin:0px 10px 10px 0px;' v-model="newEquipmentBom.ct " oninput ="value=value.replace(/[^\d]/g,'')" placeholder="请输入节拍"></el-input>
        </br>

        <div style="margin-top: 25px;">
            <span style='color: #909399;font-weight:bolder;'>零件名称：</span>
            <el-input style='width:150px;margin:0px 10px 10px 0px;' v-model.trim="newEquipmentBom.part" placeholder="请输入零件名称"></el-input>
        
            <span style='color: #909399;font-weight:bolder;'>加工等级：</span>
            <el-input style='width:100px;margin:0px 10px 10px 0px;' v-model="newEquipmentBom.level" oninput ="value=value.replace(/[^\d]/g,'')" placeholder="如1、2……"></el-input>
        
            <span style='color: #909399;font-weight:bolder;'>该等级的零件序号：</span>
            <el-input style='width:100px;margin:0px 10px 10px 0px;' v-model="newEquipmentBom.levelnumber" oninput ="value=value.replace(/[^\d]/g,'')" placeholder="如1、2……">
            </el-input>
        
            <span style='color: #909399;font-weight:bolder;'>该等级该零件序号的加工次序：</span>
            <el-input style='width:100px;margin:0px 10px 10px 0px;' v-model="newEquipmentBom.processorder" oninput ="value=value.replace(/[^\d]/g,'')" placeholder="如1、2……">
            </el-input>
            
            <el-button type="primary" plain icon="el-icon-refresh-right" @click="resetEquipmentBom" style="margin-left: 21px;">重置</el-button>
            <el-button type="primary" plain icon="el-icon-edit" @click="addEquipmentBom">添加</el-button>
            <el-button type="primary" plain icon="el-icon-search" @click="searchEquipmentBom">搜索</el-button>
        </div>
        
            <el-table :data="equipmentBomDataList" height="450" stripe fit @current-change="handleCurrentEquipmentBomChange" highlight-current-row ref="singleTableEquipmentBom">
                <el-table-column prop="model" label="产品型号" ></el-table-column>
                <el-table-column prop="equipid" label="设备编号"></el-table-column>
                <el-table-column prop="equipname" label="设备名称" width="220px"></el-table-column>
                <el-table-column prop="processname" label="工序名称"></el-table-column>
                <el-table-column prop="ct" label="节拍时间(/s)"></el-table-column>
                <el-table-column prop="part" label="零件名称"></el-table-column>
                <el-table-column prop="level" label="加工等级"></el-table-column>
                <el-table-column prop="levelnumber" label="零件序号"></el-table-column>
                <el-table-column prop="processorder" label="加工次序"></el-table-column>
                 <!-- <span style='color: #909399;font-weight:bolder;'>物料名称：</span>
            <el-input :disabled="true" style='width:190px;margin:0px 10px 10px 0px;' v-model="newEquipmentBom.partno" type="number"></el-input>
            <span style='color: #909399;font-weight:bolder;'>物料编号：</span>
            <el-input :disabled="true" style='width:190px;margin:0px 10px 10px 0px;' v-model="newEquipmentBom.partname" type="number"></el-input> -->
            </el-table>
        
            <span slot="footer" class="dialog-footer">
                    <el-popover placement="top" width="160" v-model="visible">
                        <i class="el-icon-warning"></i><span>该设备信息Bom数据确认删除吗？</span>
                        
                    <div style="text-align: right; margin: 0">
                      <el-button size="mini" type="text" @click="visible = false">取消</el-button>
                      <el-button type="primary" size="mini" @click="deleteEquipmentBom">确定</el-button>
                    </div>    
                    <el-button type="danger" plain icon="el-icon-delete" style="margin-right: 32px;" slot="reference">删 除</el-button>  
            </el-popover>

                <el-button type="info" @click="closeDialogEquipmentVisible">关 闭</el-button>
            </span>
        </el-dialog>

        <!-- 选择设备弹出框 -->
        <el-dialog title="设备选择" :visible.sync="dialogEquipmentChooseVisible">

            <el-table :data="equipmentDataList" height="450" stripe highlight-current-row @current-change="handleCurrentEquipmentChooseChange" fit>
                
                <el-table-column prop="equipid" label="设备编号"></el-table-column>
                <el-table-column prop="equipname" label="设备名称"></el-table-column>
                <el-table-column prop="workshopid" label="车间"></el-table-column>
                <el-table-column prop="lineid" label="生产线"></el-table-column>
                <el-table-column prop="stationid" label="工位"></el-table-column>
              
            </el-table>
            <span slot="footer" class="dialog-footer">
                <el-button type="success" @click="EquipmentChooseConfirm">确 认</el-button>
            </span>

        </el-dialog>



        









    </div>
</body>


<script>
    var app = new Vue({
        el: '#app',
        data: {
             // ----------------------排程单
            newScheduleRecord: {
                productionNumber: '',//生产任务单号
                orderNumber: '',//订单编号
                customerName: '',//客户名称
                model: '',//产品型号
                // partName: '',//物料名称
                number: 100, //需求数量
                date:'',//排产日期
                createTime: '',//创建时间
            },
           
            dialogRecordVisible: false,//排程记录
            inputRecordSearch1:'',//排程记录搜索框
            inputRecordSearch2:'',
            recordDataList: [],//排程记录
            loadingRecord: true,
            dialogRecordDeleteVisible:false,//删除记录确认

            //详细排程搜索框
            searchRecordDetailList:{
                productionNumber: '',//生产任务单号
                model:'',
                number:'',
                equipid:'',
                equipname:'',
                starttime:'',
                endtime:'',
            },
            recordDetailDataList: [],//生产排程对应详细表格
            loadingRecordDetail: true,      //加载框

            modelDataList: [],//选择型号
            dialogModelVisible: false,//选择型号对话框
            
            dialogEquipmentVisible: false,//设备信息编辑
            newEquipmentBom:{
                model:'',
                eqipid:'',
                equipname:'',
                processname:'',
                ct:'',
                level:'',
                levelnumber:'',
                processorder:'',
                part:'',
            },
            dialogEquipmentChooseVisible: false, //选择设备
            equipmentDataList: [],//设备信息查询
            equipmentBomDataList: [],//设备信息Bom表查询
            visible: false,//popConfirm气泡

            scheduleButton:false,//排程按钮加载状态

            pageTotal:1,//分页
            currentPage:1,

            firstSchedule:1,
            
            EquipData:{
                EquipLevel:[],
                EquipLevelnumber:[],
                EquipProcessorder:[]
            }
            // EquipLevel:[],
            // EquipLevelnumber:[]
            

        },


        //钩子函数，VUE对象初始化完成后自动执行
        created() {
            this.dateFormat();
            this.getRecordDetail();
            
        //     this.getEquipmentAll();
        //     this.getPartAll();
        //     this.getRecordDetailAll();
        // setTimeout(() => {this.loading=false}, 1500);

        },
       
        


        //所有的函数方法
        methods: { 

            //返回功能
            myReturn() {
                location.href = 'main.html';
            },
       
            //获取当前时间
            dateFormat() {
                // 为小于10的数字补零
                let date = new Date();
                let year = date.getFullYear();
                let month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
                let day = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
                let hours = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
                let minutes = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                let seconds = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();
                var createTime = year + "-" + month + "-" + day + " " + hours + ":" + minutes + ":" + seconds;
                var today = year + "-" + month + "-" + day
                this.newScheduleRecord.date=today;
                window.today=today;
            },

            //时间戳改字符串函数
            timeCalculate(time){
                let timeTemp = new Date(time)             
                            let year = timeTemp.getFullYear();
                            let month = timeTemp.getMonth() + 1 < 10 ? "0" + (timeTemp.getMonth() + 1) : timeTemp.getMonth() + 1;
                            let day = timeTemp.getDate() < 10 ? "0" + timeTemp.getDate() : timeTemp.getDate();
                            let hours = timeTemp.getHours() < 10 ? "0" + timeTemp.getHours() : timeTemp.getHours();
                            let minutes = timeTemp.getMinutes() < 10 ? "0" + timeTemp.getMinutes() : timeTemp.getMinutes();
                            let seconds = timeTemp.getSeconds() < 10 ? "0" + timeTemp.getSeconds() : timeTemp.getSeconds();
                            return year + "-" + month + "-" + day + " " + hours + ":" + minutes + ":" + seconds;
            },
             
            //删除数组重复元素
             repeat(arr) {

                for (var i = 0; i < arr.length; i++) {
                    for (var j = i + 1; j < arr.length; j++) {//第一次是拿第一个数据和剩余的n-1个数据判断是否相等、第二次是拿第二个数据和剩余的n-1个数据相比
                        if (arr[i] == arr[j]) {

                            var del = j;

                            arr.splice(del, 1);//找到了该数据的下标就删除了
                        }
                    }
                }
                return arr;
            },

            //表格选中行
            handleCurrentChangeRecord(val) {
                this.currentRow = val;
                if(this.currentRow===null){
                    return
                }
                else{
                    this.newScheduleRecord.productionNumber=this.currentRow.productionNumber
                    this.newScheduleRecord.date=this.currentRow.date //为了删除当天所有记录
                }
            },
          

             //表格索引连续
            indexAdd(index) {
                // console.log(index)
                const page = this.currentPage // 当前页码
                const pagesize = 10 // 每页条数
                return index + 1 + (page - 1) * pagesize
            },
            
            //重置排程单输入框
            newScheduleRecordResetInput() {
                this.newScheduleRecord.productionNumber = '';
                this.newScheduleRecord.orderNumber = '';
                this.newScheduleRecord.customerName = '';
                this.newScheduleRecord.model = '';
                this.newScheduleRecord.number = 100;
                this.newScheduleRecord.date = today;
                // this.newScheduleRecord.partName = '';
            },
    
            //打开生产排程记录
            openRecord() {
                this.getRecord(),
                this.dialogRecordVisible = true
            //     this.$nextTick(() => {
            //     this.$refs.singleTable.setCurrentRow(row);
                this.newScheduleRecord.productionNumber = ''
            // })
            },

            //  获取生产排程记录
            getRecord() {
                this.loadingRecord=true;
                axios({
                    url: "http://localhost:8080/getRecord",
                    method: 'GET'
                }).then(res => {
                    this.recordDataList = res.data.data;
                    this.loadingRecord=false;
                })

            },

            searchRecord(){
                this.loadingRecord=true
                // console.log("productionNumber:",this.inputRecordSearch1,"date",this.inputRecordSearch2)
                if(this.inputRecordSearch2===null){
                    this.inputRecordSearch2=''
                }
                
                axios({
                    url: "http://localhost:8080/searchRecord",
                    method: 'GET',
                    params:{
                        productionNumber:this.inputRecordSearch1,
                        date:this.inputRecordSearch2
                    }
                }).then(res => {
                    this.recordDataList = res.data;
                    this.loadingRecord=false
                })

            },

            //排程记录弹窗确认
            confirmRecord() {
                if(this.newScheduleRecord.productionNumber===''){
                    // ||this.newScheduleRecord.productionNumber===null
                    // this.recordCancel();
                this.dialogRecordVisible = false;
                this.newScheduleRecordResetInput();
                this.newScheduleRecord.productionNumber =''
                this.getRecordDetail();//如果为空默认查找所有数据
                }
                else{
                this.loadingRecordDetail=false

                this.dialogRecordVisible = false;
                this.newScheduleRecord.productionNumber=this.currentRow.productionNumber
                this.newScheduleRecord.orderNumber=this.currentRow.orderNumber
                this.newScheduleRecord.customerName=this.currentRow.customerName
                this.newScheduleRecord.model=this.currentRow.model
                // this.newScheduleRecord.partName=this.currentRow.partName
                this.newScheduleRecord.number=this.currentRow.number
                this.newScheduleRecord.date=this.currentRow.date
                this.currentPage=1

                this.searchRecordDetailList.productionNumber=this.currentRow.productionNumber

                axios({
                    url: "http://localhost:8080/getRecordDetail",
                    method: 'GET',
                    params:{
                        current:this.currentPage,
                        productionNumber:this.newScheduleRecord.productionNumber

                    }
                }).then(res => {
                    this.recordDetailDataList = res.data.data;
                    this.pageTotal=res.data.total
                    this.loadingRecordDetail=false
                    
                })
               
            }
            },
            
            //  关闭生产排程记录弹窗
            closeRecord() {
                this.dialogRecordVisible = false;
                this.newScheduleRecord.date=today;
            },
            
            //删除生产排程记录
            deleteRecord() {

                // console.log("delete按钮按下了",this.newScheduleRecord.productionNumber)
                if(this.newScheduleRecord.productionNumber ===''){
                    this.$message({
                            message: '请选择要删除的数据',
                            type: 'error'
                        })
                }
                else 
                {     
                    this.dialogRecordDeleteVisible=true

                    }
            },
            //删除生产排程记录-------------------------------------------------------------END
            recordDeleteConfirm() {
                this.loadingRecord = true
                this.loadingRecordDetail = true
                axios({
                    url: 'http://localhost:8080/deleteRecord',
                    method: 'POST',
                    data: this.newScheduleRecord,
                }).then(res => {
                    this.loading = false
                    this.loadingRecord = false
                    
                    
                        this.$message({
                            message: '删除成功',
                            type: 'success'
                        })
                    
                    //删除成功标语
                    this.newScheduleRecord.productionNumber=''

                }).finally(() => {
                    this.getRecord();
                })
                axios({
                    url: 'http://localhost:8080/deleteRecordDetail',
                    method: 'POST',
                    data: this.newScheduleRecord,
                }).then(res => {
                    this.loadingRecord = false
                }).finally(() => {
                    this.getRecordDetail();
                })
                this.dialogRecordDeleteVisible = false
            },
            recordDeleteCancel() {
                this.dialogRecordDeleteVisible = false
                this.$message({
                    type: 'info',
                    message: '已取消删除'
                });          

            },

            // 获取生产排程详细记录
            getRecordDetail(){
                this.currentPage=1
                this.loadingRecordDetail=true
                axios({
                    url: "http://localhost:8080/getRecordDetail",
                    method: 'GET',
                    params:{
                        current:this.currentPage,
                        productionNumber:''
                    }
                }).then(res => {
                    this.recordDetailDataList = res.data.data;
                    this.pageTotal=res.data.total
                    this.loadingRecordDetail=false
                })
                

            },
            //搜索详细记录
            searchRecordDetail(){
                // console.log("productionNumber",this.searchRecordDetailList.productionNumber)
                // console.log("mode",this.searchRecordDetailList.model)
                // console.log("number",this.searchRecordDetailList.number)
                // console.log("equipid",this.searchRecordDetailList.equipid)
                // console.log("equipname",this.searchRecordDetailList.equipname)
                // console.log("starttime",this.searchRecordDetailList.starttime)
                // console.log("endtime",this.searchRecordDetailList.endtime)
                this.loadingRecordDetail=true
                this.currentPage=1
                axios({
                    url: "http://localhost:8080/searchRecordDetail",
                    method: 'GET',
                    params:{
                        current:this.currentPage,
                        productionNumber:this.searchRecordDetailList.productionNumber,
                        model: this.searchRecordDetailList.model,
                        number: this.searchRecordDetailList.number,
                        equipid: this.searchRecordDetailList.equipid,
                        equipname: this.searchRecordDetailList.equipname,
                        starttime: this.searchRecordDetailList.starttime,
                        endtime: this.searchRecordDetailList.endtime,
                    }
                }).then(res => {
                    
                    this.recordDetailDataList = res.data.data;
                    this.pageTotal=res.data.total
                    this.loadingRecordDetail=false
                })
                
                
                

            },

            //详细记录清空
            clearRecordDetail(){
                
                this.searchRecordDetailList.productionNumber= '',
                this.searchRecordDetailList.equipid='',
                this.searchRecordDetailList.equipname='',
                this.searchRecordDetailList.starttime='',
                this.searchRecordDetailList.endtime='',
                this.searchRecordDetailList.number='',
                this.searchRecordDetailList.model=''

            },

            //分页选择器
            handleCurrentPageChange(val){
                this.currentPage=val
                // console.log("选中了第几页",val)
                axios({
                    // url: "http://localhost:8080/recordDetailList",
                    // method: 'GET',
                    // params:{
                    //     current: this.currentPage,
                    //     productionNumber: this.newScheduleRecord.productionNumber
                    // }
                    url: "http://localhost:8080/recordDetailListSearch",
                    method: 'GET',
                    params:{
                        current:this.currentPage,
                        productionNumber:this.searchRecordDetailList.productionNumber,
                        model: this.searchRecordDetailList.model,
                        number: this.searchRecordDetailList.number,
                        equipid: this.searchRecordDetailList.equipid,
                        equipname: this.searchRecordDetailList.equipname,
                        starttime: this.searchRecordDetailList.starttime,
                        endtime: this.searchRecordDetailList.endtime,
                    }
                }).then(res => {
                    this.recordDetailDataList = res.data.data;
                    this.pageTotal=res.data.total
                })
            },

            //  打开选择型号
            openModel(){
                this.dialogModelVisible = true;
                this.newScheduleRecord.model = '';
                this.getModel();
            //     this.$nextTick(() => {
            //     this.$refs.singleTable2.setCurrentRow(row)
            // })
            },
            
            //生产物料选择查询------------------------
            getModel() {
                //发送ajax请求
                axios({
                    url: "http://localhost:8080/getModel",
                    method: 'GET'
                }).then(res => {
                    this.modelDataList = res.data.data;
                })
                   
            },
           // 型号选择弹框确认与关闭
            closeModel() {
                this.dialogModelVisible = false;
               
            },
            confirmModel() {
                this.dialogModelVisible = false;
                this.newScheduleRecord.model = this.currentRow.model;

            },

            handleCurrentChangeModel(val) {
                this.currentRow = val;
            },

            //打开设备Bom表
            openEquipmentBom() { 
            this.dialogEquipmentVisible = true
            //清空input
                this.resetEquipmentBom()
            this.getEquipmentBom()
            // this.$nextTick(() => {
            //     this.$refs.singleTableEquipmentBom.setCurrentRow(row);
            
            // })
            },

            //获取设备Bom
            getEquipmentBom(){
                axios({
                    url: "http://localhost:8080/getEquipmentBom",
                    method: 'GET'
                }).then(res => {
                    this.equipmentBomDataList = res.data.data;
                })
            },           

            //选择设备
            chooseEquipment(){
                this.dialogEquipmentChooseVisible = true
                axios({
                    url: "http://localhost:8080/getEquipment",
                    method: 'GET'
                }).then(res => {
                    this.equipmentDataList = res.data.data;
                })
            },
            handleCurrentEquipmentChooseChange(val){
                this.currentRow = val;
            },

            // 设备选择确认
            EquipmentChooseConfirm(){
                if(this.currentRow===null||typeof(this.currentRow)=='undefined'){
                this.newEquipmentBom.equipid=''
                this.newEquipmentBom.equipname=''
                this.dialogEquipmentChooseVisible = false
                }
                else{
                this.newEquipmentBom.equipid=this.currentRow.equipid
                this.newEquipmentBom.equipname=this.currentRow.equipname
                this.dialogEquipmentChooseVisible = false
                }
                
            },
            //设备信息表关闭
            closeDialogEquipmentVisible() {
                this.dialogEquipmentVisible = false;
            },
            //重置设备信息
            resetEquipmentBom(){
                this.newEquipmentBom.model=''
                this.newEquipmentBom.equipid=''
                this.newEquipmentBom.equipname=''
                this.newEquipmentBom.processname=''
                this.newEquipmentBom.ct=''
                this.newEquipmentBom.level=''
                this.newEquipmentBom.levelnumber=''
                this.newEquipmentBom.processorder=''
                this.newEquipmentBom.part=''
            },

            //添加设备信息Bom表
            addEquipmentBom(){
                if (this.newEquipmentBom.model == '') {
                    this.$message.error('请输入产品型号'); 
                }
                else if (this.newEquipmentBom.equipname == '') {
                    this.$message.error('请选择设备');   
                }
                else if (this.newEquipmentBom.processname == '') {
                    this.$message.error('请输入工序名称');
                    
                }
                else if (this.newEquipmentBom.ct == '') {
                    this.$message.error('请输入节拍时间');
                }
                else if (this.newEquipmentBom.part == '') {
                    this.$message.error('请输入零件名称');
                }
                else if (this.newEquipmentBom.level == '') {
                    this.$message.error('请输入加工等级');
                }
                else if (this.newEquipmentBom.levelnumber == '') {
                    this.$message.error('请输入该等级的零件序号');
                }
                else if (this.newEquipmentBom.processorder == '') {
                    this.$message.error('请输入该等级该零件序号的加工次序');
                }
                else{
                    var obj ={}
                    obj.model=this.newEquipmentBom.model
                    axios({
                        url: 'http://localhost:8080/searchEquipmentBom2',
                        method: 'GET',
                        params:{
                            model:this.newEquipmentBom.model,
                            equipid:this.newEquipmentBom.equipid,
                            equipname:this.newEquipmentBom.equipname,
                            processname:this.newEquipmentBom.processname,
                            ct:this.newEquipmentBom.ct,
                            level:this.newEquipmentBom.level,
                            levelnumber:this.newEquipmentBom.levelnumber,
                            processorder:this.newEquipmentBom.processorder,
                            part:this.newEquipmentBom.part
                        },
                        
                    }).then(res => {
                        if(res.data.length==0)
                        {
                            axios({
                        url: 'http://localhost:8080/addEquipmentBom',
                        method: 'POST',
                        data: this.newEquipmentBom,
                    }).then(res => {
                        this.$message.success('该设备信息Bom数据添加成功！');
                        this.searchEquipmentBom2()
                    })

                    //添加model
                    axios({
                        url: 'http://localhost:8080/addModel',
                        method: 'POST',
                        data: obj,
                    }).then(res => {
                        
                    })

                        }
                        else{
                            this.$message.error('当前设备信息Bom数据已存在请重新输入')
                            return
                        }
                    })
                }
            },

            //搜索设备Bom
            searchEquipmentBom(){
                
                axios({
                        url: 'http://localhost:8080/searchEquipmentBom',
                        method: 'GET',
                        params:{
                            model:this.newEquipmentBom.model,
                            equipid:this.newEquipmentBom.equipid,
                            equipname:this.newEquipmentBom.equipname,
                            processname:this.newEquipmentBom.processname,
                            ct:this.newEquipmentBom.ct,
                            level:this.newEquipmentBom.level,
                            levelnumber:this.newEquipmentBom.levelnumber,
                            processorder:this.newEquipmentBom.processorder,
                            part:this.newEquipmentBom.part
                        },
                        
                    }).then(res => {
                        // console.log(res.data)
                        // console.log(this.newEquipmentBom.model)
                        // console.log(this.newEquipmentBom.equipid)
                        // console.log(this.newEquipmentBom.equipname)
                        // console.log(this.newEquipmentBom.processname)
                        // console.log(this.newEquipmentBom.ct)
                        // console.log(this.newEquipmentBom.level)
                        // console.log(this.newEquipmentBom.levelnumber)
                        // console.log(this.newEquipmentBom.processorder)
                        // console.log(this.newEquipmentBom.part)
                        this.equipmentBomDataList = res.data
                    })

            },
            searchEquipmentBom2(){
                
                axios({
                        url: 'http://localhost:8080/searchEquipmentBom2',
                        method: 'GET',
                        params:{
                            model:this.newEquipmentBom.model,
                            equipid:this.newEquipmentBom.equipid,
                            equipname:this.newEquipmentBom.equipname,
                            processname:this.newEquipmentBom.processname,
                            ct:this.newEquipmentBom.ct,
                            level:this.newEquipmentBom.level,
                            levelnumber:this.newEquipmentBom.levelnumber,
                            processorder:this.newEquipmentBom.processorder,
                            part:this.newEquipmentBom.part
                        },
                        
                    }).then(res => {
                        this.equipmentBomDataList = res.data
                    })

            },

             
            //选择设备Bom
            handleCurrentEquipmentBomChange(val){
                this.currentRow = val;
                if(this.currentRow===null){
                    return
                }
                else{
                this.newEquipmentBom.model=this.currentRow.model
                this.newEquipmentBom.equipid=this.currentRow.equipid
                this.newEquipmentBom.equipname=this.currentRow.equipname
                this.newEquipmentBom.processname=this.currentRow.processname
                this.newEquipmentBom.ct=this.currentRow.ct
                this.newEquipmentBom.level=this.currentRow.level
                this.newEquipmentBom.levelnumber=this.currentRow.levelnumber
                this.newEquipmentBom.processorder=this.currentRow.processorder
                this.newEquipmentBom.part=this.currentRow.part
            }
            },
            //删除设备Bom
            deleteEquipmentBom(){
                this.visible = false
                if(this.newEquipmentBom.model == ''||this.newEquipmentBom.equipid==''||this.newEquipmentBom.equipname==''||this.newEquipmentBom.processname==''||this.newEquipmentBom.ct==''||this.newEquipmentBom.level==''||this.newEquipmentBom.levelnumber==''||this.newEquipmentBom.processorder==''||this.newEquipmentBom.part=='')
                {
                    this.$message.warning('请选择要删除的设备信息Bom数据！'); 
                }
                else{


                axios({
                        url: 'http://localhost:8080/deleteEquipmentBom',
                        method: 'GET',
                        params:{
                            model:this.newEquipmentBom.model,
                            equipid:this.newEquipmentBom.equipid,
                            equipname:this.newEquipmentBom.equipname,
                            processname:this.newEquipmentBom.processname,
                            ct:this.newEquipmentBom.ct,
                            level:this.newEquipmentBom.level,
                            levelnumber:this.newEquipmentBom.levelnumber,
                            processorder:this.newEquipmentBom.processorder,
                            part:this.newEquipmentBom.part
                        },
                        
                    }).then(res => {
                        this.$message.success('该设备信息Bom数据删除成功！');
                        this.getEquipmentBom();
                        
                        //搜索model是否存在
                        axios({
                        url: 'http://localhost:8080/searchEquipmentBom3',
                        method: 'GET',
                        params:{
                            model:this.newEquipmentBom.model,
                            equipid:'',
                            equipname:'',
                            processname:'',
                            ct:'',
                            level:'',
                            levelnumber:'',
                            processorder:'',
                            part:'',
                        },
                    }).then(res => {
                        if(res.data.length==0){
                        axios({
                        url: 'http://localhost:8080/deleteModel',
                        method: 'GET',
                        params:{
                            model:this.newEquipmentBom.model,
                        }
                        }) 
                        this.resetEquipmentBom(); 
                        }
                        else{
                            return
                            this.resetEquipmentBom();
                        }
                         
                    })







                    })
                }

            },




            //-----------------------calculate
            calculate(){
    
        this.scheduleButton = true
        //创建时间获取
        let date = new Date();
                let year = date.getFullYear();
                let month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
                let day = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
                let hours = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
                let minutes = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                let seconds = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();
                var createTime = year + "-" + month + "-" + day + " " + hours + ":" + minutes + ":" + seconds;
                this.newScheduleRecord.createTime = createTime;
                
                //判断是否是当日首场排程
                axios({
                        url: "http://localhost:8080/recordDetailListForSchedule",
                        method: 'GET',
                        params: {
                            date: this.newScheduleRecord.date,
                        }
                    }).then(res => {
                        if (res.data.data.length == 0) {
                            this.firstSchedule = 1
                            // console.log("进行当日首场生产排程计算", this.firstSchedule)
                        }//当日首场排程逻辑结束
                        else {
                            this.firstSchedule = 0
                            // console.log("第二场及以后排程计算", this.firstSchedule)
                        }

                    })


                if (this.newScheduleRecord.productionNumber == '') {
                    this.$message.error('请输入生产任务单号');
                    this.scheduleButton = false
                    return
                }
                else if (this.newScheduleRecord.model == '') {
                    this.$message.error('请选择产品型号');
                    this.scheduleButton = false
                    return
                }
                else if (this.newScheduleRecord.date == ''||this.newScheduleRecord.date===null) {
                    this.$message.error('请选择排产日期');
                    this.scheduleButton = false
                    return
                    
                }
                else {
                    axios({
                        url: 'http://localhost:8080/addRecord',
                        method: 'POST',
                        data: this.newScheduleRecord,
                    }).then(res => {
                            if(res.data.code == 20011){
                                this.getEquipLevel()

                                // this.timeCalculate()
                                //-----------
                                setTimeout(() => {
                                    this.timeCalculate()
                    }, 500);


                            }
                             else {
                            this.$message.error('该生产任务单号已经存在！请重新输入！');
                            }
                    }).finally(() => {
                            this.getRecord();
                            this.getRecordDetail();
                            this.scheduleButton = false
                            
                        });//finally
                }
                    // -----------------------------------------
        },

            

        getEquipLevel(){
            
            axios({
                url: 'http://localhost:8080/searchEquipmentBomForModel',
                method: 'GET',
                params:{
                        model:this.newScheduleRecord.model,
                        level:'',
                        levelnumber:'',
                        },            
                        
                    }).then(res => {
                        var EquipLevel =[]
                        var Equip=res.data
                        for (var i= 0 ;i < Equip.length ; i++)
                        {
                            EquipLevel.push(Equip[i].level)
                            this.repeat(EquipLevel) 
                        }
                        // console.log('EquipLevel:',EquipLevel)
                        window.EquipLevel=EquipLevel
                        //Data 赋值
                        this.EquipData.EquipLevel=EquipLevel

                       
                    }).then(res => { this.getEquipLevelnumber()})
        },
        
       async getEquipLevelnumber(){
        
            for(var i=0;i<EquipLevel.length;i++){
                var EquipLevelnumber=[]
                await axios({
                url: 'http://localhost:8080/searchEquipmentBomForLevelnumber',
                method: 'GET',
                params:{
                        model:this.newScheduleRecord.model,
                        level:EquipLevel[i],
                        levelnumber:'',
                        },            
                        
                    }).then(res => {
                        var Equip = res.data
                        // console.log(Equip)
                        
                        for (var i= 0 ;i < Equip.length ; i++)
                        {
                            EquipLevelnumber.push(Equip[i].levelnumber)
                            this.repeat(EquipLevelnumber)
                            
                            
                        }
                    }).then(res => {  
                        window.EquipLevelnumber=EquipLevelnumber
                        window.EquipLeveli=EquipLevel[i]
                        // console.log("EquipLevelnumber：EquipLevel",EquipLevel[i],EquipLevelnumber)
                        this.EquipData.EquipLevelnumber.push(EquipLevelnumber)
                        
                    })
                   
                    await this.getEquipProcessorder()
            }
            

        },

        async getEquipProcessorder(){
        
        for(var i=0;i<EquipLevelnumber.length;i++){
            var EquipProcessorder=[]
            await axios({
            url: 'http://localhost:8080/searchEquipmentBomForProcessorder',
            method: 'GET',
            params:{
                    model:this.newScheduleRecord.model,
                    level:EquipLeveli,
                    levelnumber:EquipLevelnumber[i],
                    },            
                    
                }).then(res => {
                    var Equip = res.data
                    // console.log(Equip)
                    window.Equip=Equip
                    
                    for (var i= 0 ;i < Equip.length ; i++)
                    {
                        EquipProcessorder.push(Equip[i].processorder)
                        this.repeat(EquipProcessorder)
                        
                        
                    }
                }).then(res => {  
                    
                    // console.log('EquipProcessorder：EquipLevelnumber',EquipLevelnumber[i],EquipProcessorder)
                    this.EquipData.EquipProcessorder.push(EquipProcessorder)
                    // this.timeCalculate()
                    
                })

                
               
                
        }
        

    },

        timeCalculate(){

            // this.EquipData=JSON.parse(JSON.stringify(this.EquipData))
                var EquipLevel=JSON.parse(JSON.stringify(this.EquipData.EquipLevel))
                var TempEquipLevelnumber=JSON.parse(JSON.stringify(this.EquipData.EquipLevelnumber))
                var TempEquipProcessorder=JSON.parse(JSON.stringify(this.EquipData.EquipProcessorder))

                var EquipLevelnumber=[]
                var EquipProcessorder=[]
                                
                for(var i=0;i<TempEquipLevelnumber.length;i++){
                    let x = TempEquipLevelnumber[i].length
                    EquipLevelnumber.push(x)
                }
                for(var j=0;j<TempEquipProcessorder.length;j++){
                    let y = TempEquipProcessorder[j].length
                    EquipProcessorder.push(y)
                }


                                // console.log('Equip数据：',this.EquipData)
                                console.log('Equip数据EquipLevel：',EquipLevel)
                                console.log('Equip数据EquipLevelnumber：',EquipLevelnumber)
                                console.log('Equip数据EquipProcessorder：', EquipProcessorder)

    },  
        // console.log(Equip)
        // if (EquipLeveli ==='1'){
            
            // for (var i=0;i<EquipProcessorder.length;i++){
               
                    // for(var j=0;j<Equip.length;j++){
                        
                    //     let timeDate = this.newScheduleRecord.date //获取排程日期
                    //     let timeStart = timeDate + ' ' + '08:30:00'
                    //     let timeStampStart = Date.parse(new Date(timeStart))//设备加工时间字符串更改为时间戳
                    //     let timeProcess = 1000 * Equip[j].ct * this.newScheduleRecord.number
                    //     let timeStampEnd = timeStampStart + timeProcess       //3级设备加工结束时间时间戳
                    //     let timeEnd = this.timeCalculate(timeStampEnd) //调用函数时间戳转化为字符串
                    //     let equipmentUpadateList={}
                    //     equipmentUpadateList.equipid = Equip[j].equipid
                    //     equipmentUpadateList.starttime = timeStart
                    //     equipmentUpadateList.endtime = timeEnd
                    //      await axios({
                    //          url: 'http://localhost:8080/updateEquipment',
                    //          method: 'POST',
                    //          data: equipmentUpadateList,
                    //      }).then(res => {console.log(Equip[j])})
                    // }
                    //     let timeDate = this.newScheduleRecord.date //获取排程日期
                    //     let timeStart = timeDate + ' ' + '08:30:00'
                    //     let timeStampStart = Date.parse(new Date(timeStart))//设备加工时间字符串更改为时间戳
                    //     let timeProcess = 1000 * Equip[j].ct * this.newScheduleRecord.number
                    //     let timeStampEnd = timeStampStart + timeProcess       //3级设备加工结束时间时间戳
                    //     let timeEnd = this.timeCalculate(timeStampEnd) //调用函数时间戳转化为字符串
                    //     let equipmentUpadateList={}
                    //     equipmentUpadateList.equipid = Equip[j].equipid
                    //     equipmentUpadateList.starttime = timeStart
                    //     equipmentUpadateList.endtime = timeEnd
                    //      axios({
                    //          url: 'http://localhost:8080/updateEquipment',
                    //          method: 'POST',
                    //          data: equipmentUpadateList,
                    //      }).then(res => {
                             
                    //      })
                    //                                 }
                

            // }
        // }
        // else{
        //     console.log("2222222")
        // }
        


















































//-------------------------------------------------------------------------------------
            //排程计算
            schedule() {
                //创建时间获取
                let date = new Date();
                let year = date.getFullYear();
                let month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
                let day = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
                let hours = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
                let minutes = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                let seconds = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();
                var createTime = year + "-" + month + "-" + day + " " + hours + ":" + minutes + ":" + seconds;
                this.newScheduleRecord.createTime = createTime;

                this.scheduleButton = true
                setTimeout(() => {
                        this.scheduleButton = false;
                    }, 5500);
                    this.loading=true,
                    setTimeout(() => {this.loading=false}, 5500);
            
                   
                    if(this.newScheduleRecord.date===null){
                        this.$message.error('请选择排产日期');
                        return
                    }
                    //判断是否是当日首场排程
                    else{
                        axios({
                                url: "http://localhost:8080/recordDetailListForSchedule",
                                method: 'GET',
                                params: {
                                    date: this.newScheduleRecord.date,
                                }
                            }).then(res => {
                                if (res.data.data.length == 0) {
                                    this.firstSchedule = 1
                                    // console.log("进行当日首场生产排程计算", this.firstSchedule)
                                }//当日首场排程逻辑结束
                                else {
                                    this.firstSchedule = 0
                                    // console.log("第二场及以后排程计算", this.firstSchedule)
                                }

                            })
                        }
                  
                if (this.newScheduleRecord.productionNumber == '') {
                    this.$message.error('请输入生产任务单号');
                    
                }
                else if (this.newScheduleRecord.partNo == '') {
                    this.$message.error('请选择物料');
                    
                }
                else if (this.newScheduleRecord.date == '') {
                    this.$message.error('请选择排产日期');
                    
                }
                else {
                    // -----------------------------------------------------------------------------
                    this.$message('计算中，请稍后……');
                    this.fullscreenLoading = true;
                    setTimeout(() => {
                        this.fullscreenLoading = false;
                    }, 3000);
                    

                    axios({
                    url: "http://localhost:8080/equipmentList",
                    method: 'GET'
                }).then(res => {
                    var Equip = res.data.data;

//------------------------------------------------------------------------------------------Equip读取
                    // console.log('生产任务单号:', this.newScheduleRecord.productionNumber);
                    // console.log('订单编号:', this.newScheduleRecord.orderNumber);
                    // console.log('客户名称:', this.newScheduleRecord.customerName);
                    // console.log('物料编号:', this.newScheduleRecord.partNo);
                    // console.log('物料名称:', this.newScheduleRecord.partName);
                    // console.log('需求数量:', this.newScheduleRecord.number);
                    // console.log('排产日期:', this.newScheduleRecord.date);
                    // console.log('创建时间:', this.newScheduleRecord.createTime);
                    // this.getEquipmentAll();
                    // console.log("计算前设备数据",Equip) 
                    //提交表单
                    axios({
                        url: 'http://localhost:8080/addRecord',
                        method: 'POST',
                        data: this.newScheduleRecord,
                    }).then(res => {

                        if (res.data.code == 20011) {

                            
                                
                                //当日首计划逻辑-------------------------------------------------------------------------------------------------------------

                    var timeEndList1 = [] //3.5级
                    var timeEndList2 = [] //3.4级
                    var timeEndList3 = [] //3.3级
                    var timeEndList4 = [] //3.2级
                    var timeEndList5 = [] //3.1级
                    var timeEndList6 = [] //2.1级
                    var timeEndList7 = [] //1.1级

                    for (var i = 0; i < Equip.length; i++) {

                        if (Equip[i].level === 3.5)//3.5级设备加工时间计算
                        {
                            if (Equip[i].processorder === 1) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 =(this.firstSchedule===1) ? timeDate + ' ' + '08:30:00' : Equip[i].endtime //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                  //设备开始加工时间与结束时间
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {
                                    
                                })
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层


                            else if (Equip[i].processorder === 2) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                //比较该设备上一订单结束时间与此订单前设备结束时间谁大
                                let a = Date.parse(new Date(timeEndList1[0]))
                                let b= Date.parse(new Date(Equip[i].endtime))

                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)

                                let timeStart3 =(this.firstSchedule===1) ? timeEndList1[0] : MaxtimeStart3 //3级设备加工开始时间字符串
                                // let timeStart3 = timeEndList1[0] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/2                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                            else if (Equip[i].processorder === 3) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期

                                 //比较该设备上一订单结束时间与此订单前设备结束时间谁大
                                let a = Date.parse(new Date(timeEndList1[1]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList1[1] : MaxtimeStart3 //3级设备加工开始时间字符串
                                // let timeStart3 = timeEndList1[1] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/3                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                            else if (Equip[i].processorder === 4) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList1[2]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList1[2] : MaxtimeStart3 //3级设备加工开始时间字符串
                            
                                // let timeStart3 = timeEndList1[2] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/3                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层
                            
                            else if (Equip[i].processorder === 5) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList1[3]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList1[3] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList1[3] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/2                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                            else if (Equip[i].processorder === 6) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList1[4]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList1[4] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList1[4] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/3                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                            else if (Equip[i].processorder === 7) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList1[5]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList1[5] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList1[5] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/4                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                            else if (Equip[i].processorder === 8) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList1[6]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList1[6] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList1[6] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/4                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                            else if (Equip[i].processorder === 9) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList1[7]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList1[7] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList1[7] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/8                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                            else if (Equip[i].processorder === 10) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList1[8]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList1[8] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList1[8] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/4                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                            else if (Equip[i].processorder === 11) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList1[9]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList1[9] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList1[9] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/2                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                timeEndList1.push(timeEnd3)
                                this.repeat(timeEndList1)
                            } //if order层

                        }
                       
                        else if (Equip[i].level === 3.4) //3.4级设备加工时间计算
                        {

                            if (Equip[i].processorder === 1) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 =(this.firstSchedule===1) ? timeDate + ' ' + '08:30:00' : Equip[i].endtime //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/4                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                  //设备开始加工时间与结束时间
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {
                                    
                                })
                                
                                timeEndList2.push(timeEnd3)
                                this.repeat(timeEndList2)
                                
                                
                            } //if order层


                            else if (Equip[i].processorder === 2) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList2[0]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList2[0] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList2[0] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/2                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
        
                                timeEndList2.push(timeEnd3)
                                this.repeat(timeEndList2)
                                
                            } //if order层

                        }

                        else if (Equip[i].level === 3.3) //3.3级设备加工时间计算
                        {

                            if (Equip[i].processorder === 1) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 =(this.firstSchedule===1) ? timeDate + ' ' + '08:30:00' : Equip[i].endtime //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/2                 //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                  //设备开始加工时间与结束时间
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {
                                    
                                })
                                
                                timeEndList3.push(timeEnd3)
                                this.repeat(timeEndList3)
                                
                                
                            } //if order层


                            else if (Equip[i].processorder === 2) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList3[0]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList3[0] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList3[0] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/2                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList3.push(timeEnd3)
                                this.repeat(timeEndList3)
                                
                            } //if order层

                        }

                        else if (Equip[i].level === 3.2) //3.2级设备加工时间计算
                        {
                            if (Equip[i].processorder === 1) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 =(this.firstSchedule===1) ? timeDate + ' ' + '08:30:00' : Equip[i].endtime //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/4                 //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                  //设备开始加工时间与结束时间
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {
                                    
                                })
                                
                                timeEndList4.push(timeEnd3)
                                this.repeat(timeEndList4)
                                
                                
                            } //if order层


                            else if (Equip[i].processorder === 2) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList4[0]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList4[0] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList4[0] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/3                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList4.push(timeEnd3)
                                this.repeat(timeEndList4)
                                
                            } //if order层
                        }

                        else if (Equip[i].level === 3.1) //3.1级设备加工时间计算
                        {

                            if (Equip[i].processorder === 1) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let timeStart3 =(this.firstSchedule===1) ? timeDate + ' ' + '08:30:00' : Equip[i].endtime //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/5                 //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                  //设备开始加工时间与结束时间
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {
                                    
                                })
                                
                                timeEndList5.push(timeEnd3)
                                this.repeat(timeEndList5)
                                
                                
                            } //if order层


                            else if (Equip[i].processorder === 2) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList5[0]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList5[0] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList5[0] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/5                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList5.push(timeEnd3)
                                this.repeat(timeEndList5)
                                
                            } //if order层

                            else if (Equip[i].processorder === 3) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList5[1]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList5[1] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList5[1] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/5                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList5.push(timeEnd3)
                                this.repeat(timeEndList5)
                                
                            } //if order层
                            else if (Equip[i].processorder === 4) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList5[2]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList5[2] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList5[2] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/5                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList5.push(timeEnd3)
                                this.repeat(timeEndList5)
                                
                            } //if order层
                            else if (Equip[i].processorder === 5) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList5[3]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList5[3] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList5[3] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/5                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList5.push(timeEnd3)
                                this.repeat(timeEndList5)
                                
                            } //if order层
                            else if (Equip[i].processorder === 6) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList5[4]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList5[4] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList5[4] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/5                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList5.push(timeEnd3)
                                this.repeat(timeEndList5)
                                
                            } //if order层
                            else if (Equip[i].processorder === 7) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList5[5]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList5[5] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList5[5] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/5                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList5.push(timeEnd3)
                                this.repeat(timeEndList5)
                                
                            } //if order层
                            else if (Equip[i].processorder === 8) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList5[6]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList5[6] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList5[6] //3级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList5.push(timeEnd3)
                                this.repeat(timeEndList5)
                                
                            } //if order层

                        }

                        else if (Equip[i].level === 2.1) //2.1级设备加工时间计算
                        {

                            if (Equip[i].processorder === 1) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期

                                //时间比较3.1、3.2
                                let compareArr=[Date.parse(new Date(timeEndList4[timeEndList4.length-1])),Date.parse(new Date(timeEndList5[timeEndList5.length-1]))]
                                
                                // console.log("时间最大值",this.timeCalculate(Math.max.apply(null,compareArr)))
                                let a = Math.max.apply(null,compareArr)
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? this.timeCalculate(Math.max.apply(null,compareArr)) : MaxtimeStart3 //3级设备加工开始时间字符串

                                
                                // let timeStart3 =(this.firstSchedule===1) ? this.timeCalculate(Math.max.apply(null,compareArr)) : Equip[i].endtime
                                // let timeStart3 = this.timeCalculate(Math.max.apply(null,compareArr)) //2级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//2级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/2                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //2级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                  //设备开始加工时间与结束时间
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {
                                    
                                })
                                
                                timeEndList6.push(timeEnd3)
                                this.repeat(timeEndList6)
                                
                                
                            } //if order层

                        }

                        else if (Equip[i].level === 1.1) //1.1级设备加工时间计算
                        {

                            if (Equip[i].processorder === 1) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期

                                //时间比较3.1、3.2、3.3、2.1
                                let compareArr=[Date.parse(new Date(timeEndList1[timeEndList1.length-1])),Date.parse(new Date(timeEndList2[timeEndList2.length-1])),Date.parse(new Date(timeEndList3[timeEndList3.length-1])),Date.parse(new Date(timeEndList6[timeEndList6.length-1]))]
                                
                                // console.log("时间最大值",this.timeCalculate(Math.max.apply(null,compareArr)))

                                let a = Math.max.apply(null,compareArr)
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? this.timeCalculate(Math.max.apply(null,compareArr)) : MaxtimeStart3 //3级设备加工开始时间字符串


                                // let timeStart3 = this.timeCalculate(Math.max.apply(null,compareArr)) //1级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//1级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/3                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //1级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                  //设备开始加工时间与结束时间
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {
                                    
                                })
                                
                                timeEndList7.push(timeEnd3)
                                this.repeat(timeEndList7)
                                
                                
                            } //if order层

                            else if (Equip[i].processorder === 2) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList7[0]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList7[0] : MaxtimeStart3 //3级设备加工开始时间字符串
                                
                                // let timeStart3 = timeEndList7[0] //1级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number                   //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList7.push(timeEnd3)
                                this.repeat(timeEndList7)
                                
                            } //if order层

                            else if (Equip[i].processorder === 3) {
                                let timeDate = this.newScheduleRecord.date //获取排程日期
                                let a = Date.parse(new Date(timeEndList7[1]))
                                let b= Date.parse(new Date(Equip[i].endtime))
                                let c= (a>b) ? a : b
                                let  MaxtimeStart3= this.timeCalculate(c)
                                let timeStart3 =(this.firstSchedule===1) ? timeEndList7[1] : MaxtimeStart3 //3级设备加工开始时间字符串
            
                                // let timeStart3 = timeEndList7[1] //1级设备加工开始时间字符串
                                let timeStampStart3 = Date.parse(new Date(timeStart3))//3级设备加工时间字符串更改为时间戳
                                //时间戳加工时间计算
                                let timeProcess3 = 1000 * Equip[i].ct * this.newScheduleRecord.number/2                    //毫秒，每台设备不一致
                                let timeStampEnd3 = timeStampStart3 + timeProcess3       //3级设备加工结束时间时间戳
                                let timeEnd3 = this.timeCalculate(timeStampEnd3) //调用函数时间戳转化为字符串
                                let equipmentUpadateList={}
                                equipmentUpadateList.equipid = Equip[i].equipid
                                equipmentUpadateList.starttime = timeStart3
                                equipmentUpadateList.endtime = timeEnd3
                                axios({
                                    url: 'http://localhost:8080/equipmentListUpdate',
                                    method: 'POST',
                                    data: equipmentUpadateList,
                                }).then(res => {    
                                }) 
                                
                                timeEndList7.push(timeEnd3)
                                this.repeat(timeEndList7)
                                
                            } //if order层

                        }

                    } //for End---------------------------------------------------------------
                    // console.log("for循环结束打印3.5：",timeEndList1)
                    // console.log("for循环结束打印3.4：",timeEndList2)
                    // console.log("for循环结束打印3.3：",timeEndList3)
                    // console.log("for循环结束打印3.2：",timeEndList4)
                    // console.log("for循环结束打印3.1：",timeEndList5)
                    // console.log("for循环结束打印2.1：",timeEndList6)
                    // console.log("for循环结束打印1.1：",timeEndList7)
                   


                    //-----------------异步数据传输太快导致bug已解决

                    setTimeout( ()=>{this.recordDetailUpdate()} ,4000 )

                        }  //if (res.data.code == 20011) End






                        //----------------------------------------------------------首计划逻辑

                        else {
                            this.$message.error('该生产任务单号已经存在！请重新输入！');
                        }
                    }).finally(() => {
                            this.getRecord();
                            
                        });//finally

                    })//------------------------------------------------------------------------------------------Equip读取
                   



                } //else
                 // ----------------------------------------------------------------------------- 
            
         

            
            },
           
            //与schedule配合使用
        recordDetailUpdate(){
            axios({
                    url: "http://localhost:8080/equipmentList",
                    method: 'GET'
                }).then(res => {
                    var Equip2 = res.data.data;
                    // console.log("计算后数据2",Equip2)

                    for (var j = 0; j < Equip2.length; j++) {
                        let recordDetail = {}
                        recordDetail.productionNumber = this.newScheduleRecord.productionNumber
                        recordDetail.equipid = Equip2[j].equipid
                        recordDetail.equipname = Equip2[j].equipname
                        recordDetail.number = this.newScheduleRecord.number
                        recordDetail.starttime = Equip2[j].starttime
                        recordDetail.endtime = Equip2[j].endtime
                        recordDetail.model = this.newScheduleRecord.partName
                        axios({
                            url: 'http://localhost:8080/addRecordDetail',
                            method: 'POST',
                            data: recordDetail,
                        }).then(res => {
                        })
                    }
                }).finally(() => {
                    // this.getRecordDetailAll();
                    this.currentPage=1
                    axios({
                    url: "http://localhost:8080//recordDetailList",
                    method: 'GET',
                    params:{
                        current:this.currentPage,
                        productionNumber:this.newScheduleRecord.productionNumber
                    }
                }).then(res => {
                    this.recordDetailDataList = res.data.data;
                    this.pageTotal=res.data.total
                })
                  
                    // this.loading=true,
                    // setTimeout(() => {this.loading=false}, 2500);

                })//finally
        },





    
    },
        
    })
</script>

</html>